<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Home - JAVA 牛牛</title>

<meta name="description" content="">
<link rel="canonical" href="http://localhost:4000/home/"><link rel="alternate" type="application/rss+xml" title="JAVA 牛牛" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://use.fontawesome.com/releases/v5.0.13/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3,h4,h5,h6'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="256px" height="256px" viewBox="0 0 256 256" enable-background="new 0 0 256 256" xml:space="preserve">  <image id="image0" width="256" height="256" x="0" y="0"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAABGdBTUEAALGPC/xhBQAAACBjSFJN
AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABklBMVEX///99Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxf///9O0pOeAAAAhHRS
TlMAAAQjKwgXLxOD7/efFFPXuzPDGHf7S4uvN/Mko3MwXN+rQGu/LH+nII8MsyiX6+NMx1hjtzhg
R8+Te1Bn518nb0PbHzuHENPLPDRo2IRXxT+bZEhUGz1ExCL60NwVoU9bHA/JYmyu6fFyaaLUrH2V
gAH1Ei1RQloHgakFtNUDduLohQ2rommNAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAALEwAACxMBAJqc
GAAAAAd0SU1FB+QFDgsyHesd3D4AABK2SURBVHja7V35V9tIEkbOOATbYMfYAQxMbHB8cNgh8YA5
TAgB48AsC4Fs9gZm7/u+71394WtzuD/JLanVXZLIG9UPeS9G6q761Ed1XT00FFJIIYUUUkghfWlJ
k6XIg0+i0i+T08PhR3IvygIQHYnpejwxGrTgNzSW1HU99dhHAKJp/ZqS40HL3qPMDTPZJ/4BMKHf
0mTQwndp6o6ZmMSAlAMgmrvrU58OWnxNm+kzM+sXAJ/2u9SfBi2+puX7zBT8AmCOATAftPiaFu8z
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" />
</svg>
<a title="主要是想看下自己还能在多做些什么
" href="/">JAVA 牛牛</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item navigation__item--active"><a href="/home/">Home</a></li><li class="navigation__item"><a href="/module.html">模块</a></li><li class="navigation__item"><a href="/leetcode/all">leetcode(力扣)</a></li><li class="navigation__item"><a href="/algo/all">algo(算法)</a></li><li class="navigation__item"><a href="/docker/about">Docker</a></li><li class="navigation__item"><a href="/todo">TODO</a></li><li class="navigation__item"><a href="/pm">PM</a></li><li class="navigation__item"><a href="/archive.html">Archive</a></li><li class="navigation__item"><a href="/about.html">About</a></li><li class="navigation__item"><a href="https://github.com/javaniuniu">GitHub</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/WebPage"><header style="display:none;"><h1>Home</h1></header><meta itemprop="headline" content="Home"><meta itemprop="author" content="java牛牛"/><div class="js-article-content"><div class="layout--articles"><div class="article-list items items--divided"><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/mianshi/SpringBoot/0704-03"><h2 itemprop="headline" class="item__header">SpringBoot打成war包，部署到Tomcat服务器</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><p>SpringBoot默认达成jar包，使用SpringBoot构想web应用，默认使用内置的Tomcat。但考虑到项目需要集群部署或者进行优化时，就需要打成war包部署到外部的Tomcat服务器中。</p>

<p>==本文所使用SpringBoot版本为：2.0.3.RELEASE==</p>

<h4 id="一修改pomxml文件将默认的jar方式改为war">一、修改pom.xml文件将默认的jar方式改为war：</h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;groupId&gt;</span>com.example<span class="nt">&lt;/groupId&gt;</span>
<span class="nt">&lt;artifactId&gt;</span>application<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="c">&lt;!--默认为jar方式--&gt;</span>
<span class="c">&lt;!--&lt;packaging&gt;jar&lt;/packaging&gt;--&gt;</span>
<span class="c">&lt;!--改为war方式--&gt;</span>
<span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
</code></pre></div></div>

<h4 id="二排除内置的tomcat容器两种方式都可">二、排除内置的Tomcat容器（两种方式都可）：</h4>

<p>1.排除spring-boot-starter-web中的Tomcat</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;exclusions&gt;</span>
        <span class="nt">&lt;exclusion&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/exclusion&gt;</span>
    <span class="nt">&lt;/exclusions&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>2.添加依赖</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="nt">&lt;/artifactId&gt;</span>
    <span class="c">&lt;!--打包的时候可以不用包进去，别的设施会提供。事实上该依赖理论上可以参与编译，测试，运行等周期。
        相当于compile，但是打包阶段做了exclude操作--&gt;</span>
    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h4 id="三继承orgspringframeworkbootwebservletsupportspringbootservletinitializer实现configure方法">三、继承org.springframework.boot.web.servlet.support.SpringBootServletInitializer，实现configure方法：</h4>

<p>为什么继承该类，SpringBootServletInitializer源码注释：</p>

<p>Note that a WebApplicationInitializer is only needed if you are building a war file and deploying it.</p>

<p>If you prefer to run an embedded web server then you won’t need this at all.</p>

<p>注意，如果您正在构建WAR文件并部署它，则需要WebApplicationInitializer。</p>

<p>如果你喜欢运行一个嵌入式Web服务器，那么你根本不需要这个。</p>

<p>启动类代码：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>1.方式一，启动类继承SpringBootServletInitializer实现configure：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="kd">extends</span> <span class="nc">SpringBootServletInitializer</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">SpringApplicationBuilder</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">SpringApplicationBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">sources</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>2.方式二，新增加一个类继承SpringBootServletInitializer实现configure：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServletInitializer</span> <span class="kd">extends</span> <span class="nc">SpringBootServletInitializer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">SpringApplicationBuilder</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">SpringApplicationBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//此处的Application.class为带有@SpringBootApplication注解的启动类</span>
        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">sources</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>注意事项：</p>

<p>使用外部Tomcat部署访问的时候，application.properties(或者application.yml)中配置的</p>

<p>server.port=</p>

<p>server.servlet.context-path=</p>

<p>将失效，请使用tomcat的端口，tomcat，webapps下项目名进行访问。</p>

<p>为了防止应用上下文所导致的项目访问资源加载不到的问题，</p>

<p>建议pom.xml文件中<build></build>标签下添加<finalName></finalName>标签：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
    <span class="c">&lt;!-- 应与application.properties(或application.yml)中context-path保持一致 --&gt;</span>
    <span class="nt">&lt;finalName&gt;</span>war包名称<span class="nt">&lt;/finalName&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</code></pre></div></div>

<p>使用mvn命令行打包，运行：</p>

<p>clean是清除之前的包，-Dmaven.test.skip=true是忽略测试代码</p>

<p>jar 方式打包，使用内置Tomcat：mvn clean install -Dmaven.test.skip=true</p>

<p>运行：java -jar 包名.jar</p>

<p>war方式打包，使用外置Tomcat：mvn clean package -Dmaven.test.skip=true</p>

<p>运行：${Tomcat_home}/bin/目录下执行startup.bat(windows)或者startup.sh(linux)</p>
</div><p><a href="/mianshi/SpringBoot/0704-03">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E9%9D%A2%E8%AF%95%E9%A2%98">面试题</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jul 04, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="mianshi-2020-07-04-05">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-07-04T00:00:00+08:00">
    <meta itemprop="keywords" content="面试题"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/mianshi/socket/0704"><h2 itemprop="headline" class="item__header">长连接与短连接的区别以及使用场景</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><p><strong>首先介绍下短链接和长连接的区别：
短连接</strong>
连接-&gt;传输数据-&gt;关闭连接
比如HTTP是无状态的的短链接，浏览器和服务器每进行一次HTTP操作，就建立一次连接，但任务结束就中断连接。
具体就是 浏览器client发起并建立TCP连接 -&gt; client发送HttpRequest报文 -&gt; server接收到报文-&gt;server handle并发送HttpResponse报文给前端,发送完毕之后立即调用socket.close方法-&gt;client接收response报文-&gt;client最终会收到server端断开TCP连接的信号-&gt;client 端断开TCP连接，具体就是调用close方法。</p>

<p>也可以这样说：短连接是指SOCKET连接后，发送接收完数据后马上断开连接。
因为连接后接收了数据就断开了，所以每次数据接受处理不会有联系。 这也是HTTP协议无状态的原因之一。</p>

<p><strong>长连接</strong>
连接-&gt;传输数据-&gt;保持连接 -&gt; 传输数据-&gt; ………..-&gt;直到一方关闭连接，多是客户端关闭连接。
长连接指建立SOCKET连接后不管是否使用都保持连接，但安全性较差。</p>

<p><strong>HTTP在短链接和长连接上的选择：</strong></p>

<p>HTTP是无状态的 ，也就是说，浏览器和服务器每进行一次HTTP操作，就建立一次连接，但任务结束就中断连接。如果客户端浏览器访问的某个HTML或其他类型的 Web页中包含有其他的Web资源，如JavaScript文件、图像文件、CSS文件等；当浏览器每遇到这样一个Web资源，就会建立一个HTTP会话</p>

<p>HTTP1.1和HTTP1.0相比较而言，最大的区别就是增加了持久连接支持(貌似最新的HTTP1.1 可以显示的指定 keep-alive),但还是无状态的，或者说是不可以信任的。
如果浏览器或者服务器在其头信息加入了这行代码 Connection:keep-alive
TCP连接在发送后将仍然保持打开状态，于是，浏览器可以继续通过相同的连接发送请求。保持连接节省了为每个请求建立新连接所需的时间，还节约了带宽。
实现长连接要客户端和服务端都支持长连接。</p>

<p><strong>什么时候用长连接，短连接？</strong>
长连接多用于操作频繁，点对点的通讯，而且连接数不能太多情况，。每个TCP连接都需要三步握手，这需要时间，如果每个操作都是先连接，再操作的话那么处理速度会降低很多，所以每个操作完后都不断开，次处理时直接发送数据包就OK了，不用建立TCP连接。例如：数据库的连接用长连接， 如果用短连接频繁的通信会造成socket错误，而且频繁的socket 创建也是对资源的浪费。</p>

<p>而像WEB网站的http服务一般都用短链接，因为长连接对于服务端来说会耗费一定的资源，而像WEB网站这么频繁的成千上万甚至上亿客户端的连接用短连接会更省一些资源，如果用长连接，而且同时有成千上万的用户，如果每个用户都占用一个连接的话，那可想而知吧。所以并发量大，但每个用户无需频繁操作情况下需用短连好。</p>

<p>总之，长连接和短连接的选择要视情况而定。</p>

<p>具体网络中的应用的话：</p>

<div class="language-tex highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http 1.0一般就指短连接，smtp,pop3,telnet这种就可以认为是长连接。一般的网络游戏应用都是长连接
</code></pre></div></div>
</div><p><a href="/mianshi/socket/0704">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E9%9D%A2%E8%AF%95%E9%A2%98">面试题</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jul 04, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="mianshi-2020-07-04-07">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-07-04T00:00:00+08:00">
    <meta itemprop="keywords" content="面试题"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/mianshi/concurrent/0704"><h2 itemprop="headline" class="item__header">同步类容器和并发类容器</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><h3 id="一集合容器框架">一、集合容器框架</h3>

<p>在Java的集合容器框架中，主要有四大类别：List、Set、Queue、Map。</p>

<p>注意Collection和Map是顶层接口，而List、Set、Queue接口则分别继承了Collection接口，分别代表数组、集合和队列这三大类容器。</p>

<p>像ArrayList、LinkedList都是实现了List接口，HashSet实现了Set接口，而Deque（双向队列，允许在队首、队尾进行入队和出队操作）继承了Queue接口，PriorityQueue实现了Queue接口。另外LinkedList（实际上是双向链表）同时也实现了Deque接口。</p>

<p>但以上容器都是非线程安全的。如果有多个线程并发地访问这些容器时，就会出现问题。因此，在编写程序时，必须要求程序员手动地在访问到这些容器的地方进行同步处理，这样导致在使用这些容器的时候非常地不方便。所以，Java提供了同步容器供用户使用。</p>

<h3 id="二java中的同步类容器">二、Java中的同步类容器</h3>

<p>在Java中，同步容器主要包括2类：</p>

<p>　　1）Vector、Stack、HashTable</p>

<p>　　2）Collections类中提供的静态工厂方法创建的类</p>

<p>Vector实现了List接口，Vector实际上就是一个数组，和ArrayList类似，但是Vector中的方法都是synchronized方法，即进行了同步措施；Stack也是一个同步容器，它的方法也用synchronized进行了同步，它实际上是继承于Vector类；HashTable实现了Map接口，它和HashMap很相似，但是HashTable进行了同步处理，而HashMap没有。</p>

<p>Collections类是一个工具提供类，注意，它和Collection不同，Collection是一个顶层的接口。在Collections类中提供了大量的方法，比如对集合或者容器进行排序、查找等操作。最重要的是，在它里面提供了几个静态工厂方法来创建同步容器类，如下图所示：</p>

<p>这些同步容器都是通过synchronized进行同步来实现线程安全的，那么很显然，这必然会影响到执行性能。</p>

<p>而且虽然他们都是线程安全的，但这并不说明在任何情况下都可以线程安全，看你怎么用了，例如下面的这个例子：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span>
                <span class="n">vector</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="nc">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(){</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++)</span>
                        <span class="n">vector</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">};</span>
            <span class="o">};</span>
            <span class="nc">Thread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(){</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++)</span>
                        <span class="n">vector</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">};</span>
            <span class="o">};</span>
            <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="n">thread2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">activeCount</span><span class="o">()&gt;</span><span class="mi">10</span><span class="o">)</span>   <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>运行结果是在执行过程中会出现数组下标越界的运行时异常。也许有朋友会问：Vector是线程安全的，为什么还会报这个错？很简单，对于Vector，虽然能保证每一个时刻只能有一个线程访问它，但是不排除这种可能，当某个线程在某个时刻执行这句时：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> for(int i=0;i&lt;vector.size();i++)
 vector.get(i);
</code></pre></div></div>

<p>假若此时vector的size方法返回的是10，i的值为9，在他要获取下标为9的元素时，有另外一个线程先执行了这句：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> for(int i=0;i&lt;vector.size();i++)
 	vector.remove(i);
</code></pre></div></div>

<p>将下标为9的元素删除了，在删除过程中因为有锁，所以之前的那个线程无法执行vector.get(i);处于阻塞状态，等这个线程把下标为9的元素删除了之后获取到锁再执行。那么通过get方法访问下标为9的元素肯定就会出问题了。说明这是程序逻辑本身存在线程安全问题，因此为了保证线程安全，必须在方法调用端做额外的同步措施，如下面所示：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span>
                <span class="n">vector</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="nc">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(){</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                    <span class="kd">synchronized</span> <span class="o">(</span><span class="nc">Test</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>   <span class="c1">//进行额外的同步</span>
                        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++)</span>
                            <span class="n">vector</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">};</span>
            <span class="o">};</span>
            <span class="nc">Thread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(){</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                    <span class="kd">synchronized</span> <span class="o">(</span><span class="nc">Test</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++)</span>
                            <span class="n">vector</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">};</span>
            <span class="o">};</span>
            <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="n">thread2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">activeCount</span><span class="o">()&gt;</span><span class="mi">10</span><span class="o">)</span>   <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="三java中的并发类容器">三、Java中的并发类容器</h3>

<p>为了解决同步类容器的性能问题，在Java 1.5之后提供了并发容器，位于java.util.concurrent目录下，这个目录俗称并发包。</p>

<h4 id="31concurrentmap">3.1、ConcurrentMap</h4>

<p>ConcurrentMap接口下有两个重要的实现：ConcurrentHashMap、ConcurrentSkipListMap。ConcurrentHashMap把整个哈希表分成多个segment，每个segment一把锁，主要通过锁分段技术减小了锁的粒度，降低了冲突，从而提高了并发性。在实际的应用中，散列表一般是读多写少。ConcurrentHashMap 就针对读操作做了大量的优化，运用了很多并发技巧，如不可变对象和使用volatile保证内存可见性，这样，在大多数情况下读操作甚至无需加锁也能获得正确的值。ConcurrentHashMap的concurrencyLevel（默认值为16）表示并发级别，这个值用来确定Segment的个数，Segment的个数是大于等于concurrencyLevel的第一个2的n次方的数。比如，如果concurrencyLevel为12，13，14，15，16这些数，则Segment的数目为16(2的4次方)。理想情况下ConcurrentHashMap的真正的并发访问量能够达到concurrencyLevel，因为有concurrencyLevel个Segment，假如有concurrencyLevel个线程需要访问Map，并且需要访问的数据都恰好分别落在不同的Segment中，则这些线程能够无竞争地自由访问（因为他们不需要竞争同一把锁），达到同时访问的效果。这也是为什么这个参数起名为“并发级别”的原因。该值设置过高会照成空间的浪费，设置过低会降低并发性。这种对调优的把握是要通过对底层实现的深刻理解和不断的实践积累才能获取的。</p>

<h4 id="32copyonwirte容器">3.2、CopyOnWirte容器</h4>

<p>Cope-On-Write简称COW，是一种用于程序设计中的优化策略，称为写时复制，理解起来很简单，就是执行修改操作时进行底层数组复制，使得修改操作在新的数组上进行，不妨碍原数组的并发读操作，复制修改完成后把原数组引用指向新数组。这样做的好处是可以并发的读而不需要加锁，因为当前容器不会添加任何元素，所以也是一种读写分离的思想。但正是因为写时复制，所以不能保证数据的实时性，而只能保证最终一致性。</p>

<p>在concurrent包下实现CopyOnWrite机制的容器有两种，CopyOnWriteArrayList和CopyOnWriteArraySet。</p>

<p>CopyOnWriteArrayList中有一个Object数组array用来存放数据，对于set()、add()、remove()等修改数据的操作会加上重入锁ReentrantLock，等修改操作完成替换掉array的引用之后才释放锁，从而保证写操作的线程安全，而针对读操作没有任何锁。</p>

<p>CopyOnWriteArraySet其实就是一个CopyOnWriteArrayList，不过就是在方法中避免重复数据而已，甚至这些避免重复数据的函数也是在CopyOnWriteArrayList中定义的，CopyOnWriteArraySet中只是包含一个CopyOnWriteArrayList的属性，然后在方法上做个包装，除了equals方法外，其他当前类中的所有函数都是调用的CopyOnWriteArrayList的方法，所以严格来讲可以使用一个CopyOnWriteArrayList作为具有Set特性的写时复制数组（不过就是没有继承AbstractSet）。</p>

<p>根据CopyOnWirte容器的实现原理可知，CopyOnWirte容器保证读写分离，十分适合读多写少的场景，但不适合写多的场景。</p>

<h4 id="33线程安全队列">3.3、线程安全队列</h4>

<p>在并发编程中我们有时候需要使用线程安全的队列。如果我们要实现一个线程安全的队列有两种实现方式一种是使用阻塞算法，另一种是使用非阻塞算法。使用阻塞算法的队列可以用一个锁（入队和出队用同一把锁）或两个锁（入队和出队用不同的锁）等方式来实现，而非阻塞的实现方式则可以使用循环CAS的方式来实现。java.util.concurrent.atomic包相关类就是CAS的实现。</p>

<p>ConcurrentLinkedQueue是一个适用于高并发场景下的非阻塞的队列，通过无锁的方式(采用CAS操作)，实现了高并发状态下的高性能，通常ConcurrentLinkedQueue的性能优于BlockingQueue。ConcurrentLinkedQueue是一个基于链接节点的无界线程安全队列，它采用先进先出的规则对节点进行排序，当我们添加一个元素的时候，它会添加到队列的尾部，当我们获取一个元素时，它会返回队列头部的元素，该队列不允许NULL元素。</p>

<p>阻塞队列当队列是空的时候，再想获取元素就会阻塞进入等待状态，所以非常适合生产者-消费者模式。阻塞队列BlockingQueue接口JDK提供了7种实现：</p>

<ul>
  <li>ArrayBlockingQueue ：一个由数组结构组成的有界阻塞队列。</li>
  <li>LinkedBlockingQueue ：一个由链表结构组成的有界阻塞队列。</li>
  <li>PriorityBlockingQueue ：一个支持优先级排序的无界阻塞队列。</li>
  <li>DelayQueue：一个使用优先级队列实现的无界阻塞队列。</li>
  <li>SynchronousQueue：一个不存储元素的阻塞队列。</li>
  <li>LinkedTransferQueue：一个由链表结构组成的无界阻塞队列。</li>
  <li>LinkedBlockingDeque：一个由链表结构组成的双向阻塞队列。</li>
</ul>
</div><p><a href="/mianshi/concurrent/0704">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E9%9D%A2%E8%AF%95%E9%A2%98">面试题</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jul 04, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="mianshi-2020-07-04-03">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-07-04T00:00:00+08:00">
    <meta itemprop="keywords" content="面试题"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/mianshi/Transactional/0704/05"><h2 itemprop="headline" class="item__header">只读事务（@Transactional(readOnly = true)）的一些概念</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><p>念：从这一点设置的时间点开始（时间点a）到这个事务结束的过程中，其他事务所提交的数据，该事务将看不见！（查询中不会出现别人在时间点a之后提交的数据）</p>

<p>应用场合：</p>

<p>如果你一次执行单条查询语句，则没有必要启用事务支持，数据库默认支持SQL执行期间的读一致性；
如果你一次执行多条查询语句，例如统计查询，报表查询，在这种场景下，多条查询SQL必须保证整体的读一致性，否则，在前条SQL查询之后，后条SQL查询之前，数据被其他用户改变，则该次整体的统计查询将会出现读数据不一致的状态，此时，应该启用事务支持。
【注意是一次执行多次查询来统计某些信息，这时为了保证数据整体的一致性，要用只读事务】</p>

<p>怎样设置：</p>

<p>对于只读查询，可以指定事务类型为readonly，即只读事务。
由于只读事务不存在数据的修改，因此数据库将会为只读事务提供一些优化手段，例如Oracle对于只读事务，不启动回滚段，不记录回滚log。</p>

<p>（1）在JDBC中，指定只读事务的办法为： connection.setReadOnly(true);</p>

<p>（2）在Hibernate中，指定只读事务的办法为： session.setFlushMode(FlushMode.NEVER);
此时，Hibernate也会为只读事务提供Session方面的一些优化手段</p>

<p>（3）在Spring的Hibernate封装中，指定只读事务的办法为： bean配置文件中，prop属性增加“readOnly”
或者用注解方式@Transactional(readOnly=true)
【 if the transaction is marked as read-only, Spring will set the Hibernate Session’s flush mode to FLUSH_NEVER,
and will set the JDBC transaction to read-only】也就是说在Spring中设置只读事务是利用上面两种方式</p>

<p>在将事务设置成只读后，相当于将数据库设置成只读数据库，此时若要进行写的操作，会出现错误</p>
</div><p><a href="/mianshi/Transactional/0704/05">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E9%9D%A2%E8%AF%95%E9%A2%98">面试题</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jul 04, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="mianshi-2020-07-04-04">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-07-04T00:00:00+08:00">
    <meta itemprop="keywords" content="面试题"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/mianshi/queue/0704"><h2 itemprop="headline" class="item__header">什么是阻塞队列？如何使用阻塞队列来实现生产者-消费者模型？</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><h2 id="什么是阻塞队列">什么是阻塞队列？</h2>

<p>阻塞队列是一个在队列基础上又支持了两个附加操作的队列。</p>

<p>2个附加操作：</p>

<p>支持阻塞的<strong>插入</strong>方法：队列满时，队列会阻塞插入元素的线程，直到队列不满。</p>

<p>支持阻塞的<strong>移除</strong>方法：队列空时，获取元素的线程会等待队列变为非空。</p>

<h2 id="阻塞队列的应用场景">阻塞队列的应用场景</h2>

<p>阻塞队列常用于生产者和消费者的场景，生产者是向队列里添加元素的线程，消费者是从队列里取元素的线程。简而言之，阻塞队列是生产者用来存放元素、消费者获取元素的容器。</p>

<h2 id="几个方法">几个方法</h2>

<p>在阻塞队列不可用的时候，上述2个附加操作提供了四种处理方法</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">方法处理方式</th>
      <th style="text-align: left">抛出异常</th>
      <th style="text-align: left">返回特殊值</th>
      <th style="text-align: left">一直阻塞</th>
      <th style="text-align: left">超时退出</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">插入方法</td>
      <td style="text-align: left">add(e)</td>
      <td style="text-align: left">offer(e)</td>
      <td style="text-align: left">put(e)</td>
      <td style="text-align: left">offer(e,time,unit)</td>
    </tr>
    <tr>
      <td style="text-align: left">移除方法</td>
      <td style="text-align: left">remove()</td>
      <td style="text-align: left">poll()</td>
      <td style="text-align: left">take()</td>
      <td style="text-align: left">poll(time,unit)</td>
    </tr>
    <tr>
      <td style="text-align: left">检查方法</td>
      <td style="text-align: left">element()</td>
      <td style="text-align: left">peek()</td>
      <td style="text-align: left">不可用</td>
      <td style="text-align: left">不可用</td>
    </tr>
  </tbody>
</table>

<h2 id="java里的阻塞队列">JAVA里的阻塞队列</h2>

<p>JDK 7 提供了7个阻塞队列，如下</p>

<p>1、<strong>ArrayBlockingQueue</strong> 数组结构组成的有界阻塞队列。</p>

<p>此队列按照先进先出（FIFO）的原则对元素进行排序，但是默认情况下不保证线程公平的访问队列，即如果队列满了，那么被阻塞在外面的线程对队列访问的顺序是不能保证线程公平（即先阻塞，先插入）的。</p>

<p>2、<strong>LinkedBlockingQueue</strong>一个由链表结构组成的有界阻塞队列</p>

<p>此队列按照先出先进的原则对元素进行排序</p>

<p>3、<strong>PriorityBlockingQueue</strong> 支持优先级的无界阻塞队列</p>

<p>4、<strong>DelayQueue</strong> 支持延时获取元素的无界阻塞队列，即可以指定多久才能从队列中获取当前元素</p>

<p>5、<strong>SynchronousQueue</strong>不存储元素的阻塞队列，每一个put必须等待一个take操作，否则不能继续添加元素。并且他支持公平访问队列。</p>

<p>6、<strong>LinkedTransferQueue</strong>由链表结构组成的无界阻塞TransferQueue队列。相对于其他阻塞队列，多了tryTransfer和transfer方法</p>

<p>transfer方法</p>

<p>如果当前有消费者正在等待接收元素（take或者待时间限制的poll方法），transfer可以把生产者传入的元素立刻传给消费者。如果没有消费者等待接收元素，则将元素放在队列的tail节点，并等到该元素被消费者消费了才返回。</p>

<p>tryTransfer方法</p>

<p>用来试探生产者传入的元素能否直接传给消费者。，如果没有消费者在等待，则返回false。和上述方法的区别是该方法无论消费者是否接收，方法立即返回。而transfer方法是必须等到消费者消费了才返回。</p>

<p>7、LinkedBlockingDeque链表结构的双向阻塞队列，优势在于多线程入队时，减少一半的竞争。</p>

<h2 id="如何使用阻塞队列来实现生产者-消费者模型">如何使用阻塞队列来实现生产者-消费者模型？</h2>

<p>通知模式实现：所谓通知模式，就是当生产者往满的队列里添加元素时会阻塞住生产者，当消费者消费了一个队列中的元素后，会通知生产者当前队列可用。</p>

<h2 id="使用blockingqueue解决生产者消费者问题">使用BlockingQueue解决生产者消费者问题</h2>

<p><strong>为什么BlockingQueue适合解决生产者消费者问题</strong></p>

<p>任何有效的生产者-消费者问题解决方案都是通过控制生产者put()方法（生产资源）和消费者take()方法（消费资源）的调用来实现的，一旦你实现了对方法的阻塞控制，那么你将解决该问题。</p>

<p>Java通过BlockingQueue提供了开箱即用的支持来控制这些方法的调用（一个线程创建资源，另一个消费资源）。java.util.concurrent包下的BlockingQueue接口是一个线程安全的可用于存取对象的队列。</p>

<p><strong>BlockingQueue是一种数据结构，支持一个线程往里存资源，另一个线程从里取资源。这正是解决生产者消费者问题所需要的，那么让我们开始解决该问题吧。</strong></p>

<p><strong>生产者</strong></p>

<p>以下代码用于生产者线程</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">io.ymq.example.thread</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.concurrent.BlockingQueue</span><span class="o">;</span>
 
<span class="cm">/**
 * 描述:生产者
 *
 * @author yanpenglei
 * @create 2018-03-14 15:52
 **/</span>
<span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
 
    <span class="kd">protected</span> <span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">;</span>
 
    <span class="nc">Producer</span><span class="o">(</span><span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">theQueue</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">queue</span> <span class="o">=</span> <span class="n">theQueue</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Object</span> <span class="n">justProduced</span> <span class="o">=</span> <span class="n">getResource</span><span class="o">();</span>
                <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">justProduced</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"生产者资源队列大小= "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"生产者 中断"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nc">Object</span> <span class="nf">getResource</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"生产者 读 中断"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Object</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<p><strong>消费者</strong></p>

<p>以下代码用于消费者线程</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">io.ymq.example.thread</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.concurrent.BlockingQueue</span><span class="o">;</span>
 
<span class="cm">/**
 * 描述: 消费者
 *
 * @author yanpenglei
 * @create 2018-03-14 15:54
 **/</span>
<span class="kd">class</span> <span class="nc">Consumer</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">;</span>
 
    <span class="nc">Consumer</span><span class="o">(</span><span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">theQueue</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">queue</span> <span class="o">=</span> <span class="n">theQueue</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">();</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"消费者 资源 队列大小 "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
                <span class="n">take</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"消费者 中断"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kt">void</span> <span class="nf">take</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span> <span class="c1">// simulate time passing</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"消费者 读 中断"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"消费对象 "</span> <span class="o">+</span> <span class="n">obj</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<p><strong>测试该解决方案是否运行正常</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">io.ymq.example.thread</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.BlockingQueue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.LinkedBlockingQueue</span><span class="o">;</span>
 
<span class="cm">/**
 * 描述: 测试
 *
 * @author yanpenglei
 * @create 2018-03-14 15:58
 **/</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerConsumerExample</span> <span class="o">{</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
 
        <span class="kt">int</span> <span class="n">numProducers</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">numConsumers</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
 
        <span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">myQueue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;(</span><span class="mi">5</span><span class="o">);</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numProducers</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Producer</span><span class="o">(</span><span class="n">myQueue</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numConsumers</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Consumer</span><span class="o">(</span><span class="n">myQueue</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
 
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
 
        <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<p><strong>运行结果</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>生产者资源队列大小= 1
生产者资源队列大小= 1
消费者 资源 队列大小 1
生产者资源队列大小= 1
消费者 资源 队列大小 1
消费者 资源 队列大小 1
生产者资源队列大小= 1
生产者资源队列大小= 3
消费对象 java.lang.Object@1e1aa52b
生产者资源队列大小= 2
生产者资源队列大小= 5
消费对象 java.lang.Object@6e740a76
消费对象 java.lang.Object@697853f6
 
......
 
消费对象 java.lang.Object@41a10cbc
消费对象 java.lang.Object@4963c8d1
消费者 资源 队列大小 5
生产者资源队列大小= 5
生产者资源队列大小= 5
消费者 资源 队列大小 4
消费对象 java.lang.Object@3e49c35d
消费者 资源 队列大小 4
生产者资源队列大小= 5


</code></pre></div></div>

<p><strong>从输出结果中,我们可以发现队列大小永远不会超过5，消费者线程消费了生产者生产的资源</strong></p>
</div><p><a href="/mianshi/queue/0704">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E9%9D%A2%E8%AF%95%E9%A2%98">面试题</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jul 04, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="mianshi-2020-07-04-02">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-07-04T00:00:00+08:00">
    <meta itemprop="keywords" content="面试题"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/mianshi/Transactional/0704/03"><h2 itemprop="headline" class="item__header">Spring事务管理的两种方式</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><p>事务管理对于企业应用来说是至关重要的，当出现异常情况时，它也可以保证数据的一致性。</p>

<h2 id="spring事务管理的两种方式">Spring事务管理的两种方式</h2>

<p><strong>spring支持编程式事务管理和声明式事务管理两种方式。</strong></p>

<ul>
  <li><strong>编程式事务</strong> 使用TransactionTemplate或者直接使用底层的PlatformTransactionManager。对于编程式事务管理，spring推荐使用TransactionTemplate。</li>
  <li><strong>声明式事务</strong> 是建立在AOP之上的。其本质是对方法前后进行拦截，然后在目标方法开始之前创建或者加入一个事务，在执行完目标方法之后根据执行情况提交或者回滚事务。声明式事务最大的优点就是不需要通过编程的方式管理事务，这样就不需要在业务逻辑代码中掺杂事务管理的代码，只需在配置文件中做相关的事务规则声明(或通过基于@Transactional注解的方式)，便可以将事务规则应用到业务逻辑中。</li>
</ul>

<p>显然声明式事务管理要优于编程式事务管理，这正是spring倡导的非侵入式的开发方式。声明式事务管理使业务代码不受污染，一个普通的POJO对象，只要加上注解就可以获得完全的事务支持。和编程式事务相比，声明式事务唯一不足地方是，它的最细粒度只能作用到方法级别，无法做到像编程式事务那样可以作用到代码块级别。但是即便有这样的需求，也存在很多变通的方法，比如，可以将需要进行事务管理的代码块独立为方法等等。</p>

<p>声明式事务管理也有两种常用的方式，一种是基于tx和aop名字空间的xml配置文件，另一种就是基于@Transactional注解。显然基于注解的方式更简单易用，更清爽。</p>

<h2 id="spring事务特性">spring事务特性</h2>

<p>spring所有的事务管理策略类都继承自<code class="language-plaintext highlighter-rouge">org.springframework.transaction.PlatformTransactionManager</code>接口。</p>

<p>其中<code class="language-plaintext highlighter-rouge">TransactionDefinition</code>接口定义以下特性：</p>

<h3 id="事务隔离级别">事务隔离级别</h3>

<p>隔离级别是指若干个并发的事务之间的隔离程度。TransactionDefinition 接口中定义了五个表示隔离级别的常量：</p>

<ul>
  <li>TransactionDefinition.ISOLATION_DEFAULT：这是默认值，表示使用底层数据库的默认隔离级别。对大部分数据库而言，通常这值就是TransactionDefinition.ISOLATION_READ_COMMITTED。</li>
  <li>TransactionDefinition.ISOLATION_READ_UNCOMMITTED：该隔离级别表示一个事务可以读取另一个事务修改但还没有提交的数据。该级别不能防止脏读，不可重复读和幻读，因此很少使用该隔离级别。比如PostgreSQL实际上并没有此级别。</li>
  <li>TransactionDefinition.ISOLATION_READ_COMMITTED：该隔离级别表示一个事务只能读取另一个事务已经提交的数据。该级别可以防止脏读，这也是大多数情况下的推荐值。</li>
  <li>TransactionDefinition.ISOLATION_REPEATABLE_READ：该隔离级别表示一个事务在整个过程中可以多次重复执行某个查询，并且每次返回的记录都相同。该级别可以防止脏读和不可重复读。</li>
  <li>TransactionDefinition.ISOLATION_SERIALIZABLE：所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。但是这将严重影响程序的性能。通常情况下也不会用到该级别。</li>
</ul>

<h3 id="事务传播行为">事务传播行为</h3>

<p>所谓事务的传播行为是指，如果在开始当前事务之前，一个事务上下文已经存在，此时有若干选项可以指定一个事务性方法的执行行为。在TransactionDefinition定义中包括了如下几个表示传播行为的常量：</p>

<ul>
  <li>TransactionDefinition.PROPAGATION_REQUIRED：如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新的事务。这是默认值。</li>
  <li>TransactionDefinition.PROPAGATION_REQUIRES_NEW：创建一个新的事务，如果当前存在事务，则把当前事务挂起。</li>
  <li>TransactionDefinition.PROPAGATION_SUPPORTS：如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务的方式继续运行。</li>
  <li>TransactionDefinition.PROPAGATION_NOT_SUPPORTED：以非事务方式运行，如果当前存在事务，则把当前事务挂起。</li>
  <li>TransactionDefinition.PROPAGATION_NEVER：以非事务方式运行，如果当前存在事务，则抛出异常。</li>
  <li>TransactionDefinition.PROPAGATION_MANDATORY：如果当前存在事务，则加入该事务；如果当前没有事务，则抛出异常。</li>
  <li>TransactionDefinition.PROPAGATION_NESTED：如果当前存在事务，则创建一个事务作为当前事务的嵌套事务来运行；如果当前没有事务，则该取值等价于TransactionDefinition.PROPAGATION_REQUIRED。</li>
</ul>

<h3 id="事务超时">事务超时</h3>

<p>所谓事务超时，就是指一个事务所允许执行的最长时间，如果超过该时间限制但事务还没有完成，则自动回滚事务。在 TransactionDefinition 中以 int 的值来表示超时时间，其单位是秒。</p>

<p>默认设置为底层事务系统的超时值，如果底层数据库事务系统没有设置超时值，那么就是none，没有超时限制。</p>

<h3 id="spring事务回滚规则">spring事务回滚规则</h3>

<p>默认配置下，spring只有在抛出的异常为运行时unchecked异常时才回滚该事务，也就是抛出的异常为RuntimeException的子类(Errors也会导致事务回滚)，而抛出checked异常则不会导致事务回滚。可以明确的配置在抛出哪些异常时回滚事务，包括checked异常。也可以明确定义那些异常抛出时不回滚事务。还可以编程性的通过setRollbackOnly()方法来指示一个事务必须回滚，在调用完setRollbackOnly()后你所能执行的唯一操作就是回滚。</p>

<h2 id="以mybatis为例基于注解的声明式事务配置">以MyBatis为例，基于注解的声明式事务配置</h2>

<p>1、添加tx名字空间</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xmlns:tx="http://www.springframework.org/schema/tx"
</code></pre></div></div>

<p>2、开启事务的注解支持</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">&lt;!-- 开启事务控制的注解支持 --&gt;</span>  
<span class="nt">&lt;tx:annotation-driven</span> <span class="na">transaction-manager=</span><span class="s">"transactionManager"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>3、MyBatis自动参与到spring事务管理中，无需额外配置，只要org.mybatis.spring.SqlSessionFactoryBean引用的数据源与DataSourceTransactionManager引用的数据源一致即可。</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"sqlSessionFactory"</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.SqlSessionFactoryBean"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>  
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"configLocation"</span><span class="nt">&gt;</span>  
		<span class="nt">&lt;value&gt;</span>classpath:mybatis-config.xml<span class="nt">&lt;/value&gt;</span>  
	<span class="nt">&lt;/property&gt;</span>  
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"transactionManager"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="nt">&gt;</span>  
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>  
<span class="nt">&lt;/bean&gt;</span>  
</code></pre></div></div>

<p><strong>4、使用@Transactional注解</strong></p>

<p>@Transactional 可以作用于接口、接口方法、类以及类方法上。当作用于类上时，该类的所有 public 方法将都具有该类型的事务属性，同时，我们也可以在方法级别使用该注解来覆盖类级别的定义。</p>

<p>虽然 @Transactional 注解可以作用于接口、接口方法、类以及类方法上，但是 Spring 建议不要在接口或者接口方法上使用该注解，因为这只有在使用基于接口的代理时它才会生效。另外， @Transactional 注解应该只被应用到 public 方法上，这是由 Spring AOP 的本质决定的。如果你在 protected、private 或者默认可见性的方法上使用 @Transactional 注解，这将被忽略，也不会抛出任何异常。</p>

<h2 id="以mybatis为例基于xml文件的声明式事务配置">以MyBatis为例，基于.xml文件的声明式事务配置</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;tx:advice</span> <span class="na">id=</span><span class="s">"advice"</span> <span class="na">transaction-manager=</span><span class="s">"transactionManager"</span><span class="nt">&gt;</span>  
    <span class="nt">&lt;tx:attributes&gt;</span>  
        <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">"update*"</span> <span class="na">propagation=</span><span class="s">"REQUIRED"</span> <span class="na">read-only=</span><span class="s">"false"</span> <span class="na">rollback-for=</span><span class="s">"java.lang.Exception"</span><span class="nt">/&gt;</span>  
        <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">"insert"</span> <span class="na">propagation=</span><span class="s">"REQUIRED"</span> <span class="na">read-only=</span><span class="s">"false"</span><span class="nt">/&gt;</span>  
    <span class="nt">&lt;/tx:attributes&gt;</span>  
<span class="nt">&lt;/tx:advice&gt;</span>  

<span class="nt">&lt;aop:config&gt;</span>  
    <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">"testService"</span> <span class="na">expression=</span><span class="s">"execution (* com.nnngu.service.MyBatisService.*(..))"</span><span class="nt">/&gt;</span>  
    <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">"advice"</span> <span class="na">pointcut-ref=</span><span class="s">"testService"</span><span class="nt">/&gt;</span>  
<span class="nt">&lt;/aop:config&gt;</span>  
</code></pre></div></div>
</div><p><a href="/mianshi/Transactional/0704/03">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E9%9D%A2%E8%AF%95%E9%A2%98">面试题</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jul 04, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="mianshi-2020-07-04-06">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-07-04T00:00:00+08:00">
    <meta itemprop="keywords" content="面试题"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/mianshi/SpringBoot/0704"><h2 itemprop="headline" class="item__header">SpringBoot面试题</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><h4 id="1spring-bootspring-mvc-和-spring-有什么区别">1、Spring Boot、Spring MVC 和 Spring 有什么区别？</h4>

<h5 id="什么是spring它解决了什么问题">什么是Spring？它解决了什么问题？</h5>

<p>我们说到Spring，一般指代的是Spring Framework，它是一个开源的应用程序框架，提供了一个简易的开发方式，<strong>通过这种开发方式，将避免那些可能致使代码变得繁杂混乱的大量的业务/工具对象，说的更通俗一点就是由框架来帮你管理这些对象，包括它的创建，销毁等</strong>，比如基于Spring的项目里经常能看到的<code class="language-plaintext highlighter-rouge">Bean</code>，它代表的就是由Spring管辖的对象。</p>

<h5 id="什么是spring-mvc它解决了什么问题">什么是Spring MVC？它解决了什么问题？</h5>

<p>Spring MVC是Spring的一部分，Spring 出来以后，大家觉得很好用，于是按照这种模式设计了一个 MVC框架（一些用Spring 解耦的组件），<strong>主要用于开发WEB应用和网络接口，它是Spring的一个模块，通过Dispatcher Servlet, ModelAndView 和 View Resolver，让应用开发变得很容易</strong></p>

<h5 id="什么是spring-boot它解决了什么问题">什么是Spring Boot？它解决了什么问题？</h5>

<p>初期的Spring通过代码加配置的形式为项目提供了良好的灵活性和扩展性，但随着Spring越来越庞大，其配置文件也越来越繁琐，太多复杂的xml文件也一直是Spring被人诟病的地方，特别是近些年其他简洁的WEB方案层出不穷，如基于Python或Node.Js，几行代码就能实现一个WEB服务器，对比起来，大家渐渐觉得Spring那一套太过繁琐，此时，Spring社区推出了Spring Boot，它的目的在于<strong>实现自动配置，降低项目搭建的复杂度</strong></p>

<h4 id="2什么是自动配置">2、什么是自动配置？</h4>

<p><strong>Spring Boot：__该框架使用了特定的方式来进行配置，从而使开发人员不再需要定义样板化的配置</strong>。__Spring Boot采用约定大约配置的方式，大量的减少了配置文件的使用</p>

<p>可以通过查看源码的run方法，通过一个简单的run方法，<strong>将引发的是一系列复杂的内部调用和加载过程，从而初始化一个应用所需的配置、环境、资源以及各种自定义的类。在这个阶段，会导入一些列自动配置的类，实现强大的自动配置的功能</strong></p>

<p>我们可以点开@SpringBootApplicaton 注解， 其中，<strong>@ComponentScan将扫描和加载一些自定义的类</strong>，<strong>@EnableAutoConfiguration将导入一些自动配置的类</strong></p>

<h4 id="3我们说的springboot约定大于配置是什么意思呢">3、我们说的springboot约定大于配置是什么意思呢？</h4>

<p>自动配置在加载一个类的时候，会首先去读取项目当中的配置文件，假如没有，就会启用默认值，这就是springboot约定大于配置原理。以Thymeleaf为例：看下下面我们就知道，为什么我们使用Thymeleaf模板引擎，html文件默认放在resources下面的templates文件夹下面，因为这是Thymeleaf的默认配置。</p>

<h4 id="4什么是-spring-boot-stater">4、什么是 Spring Boot Stater</h4>

<p>starter可以理解成pom配置了一堆jar组合的空maven项目，<strong>用来简化maven依赖配置</strong>，starter可以继承也可以依赖于别的starter。</p>

<p>如果我要使用redis，我直接引入redis驱动jar包就行了，何必要引入starter包？<strong>starter和普通jar包的区别在于，它能够实现自动配置，和Spring Boot无缝衔接，从而节省我们大量开发时间。</strong></p>

<h4 id="5你能否举一个例子来解释更多-staters-的内容">5、你能否举一个例子来解释更多 Staters 的内容</h4>

<p>比如 我们开发一个web 应用程序或者是公开的 REST 服务的应用程序 Spring Boot Stater Web，是首选，它会加载 ：</p>

<p>Spring - core，beans，context，aop</p>

<p>Web MVC - （Spring MVC）</p>

<p>Jackson - for JSON Binding</p>

<p>Validation - Hibernate,Validation API</p>

<p>Enbedded Servlet Container - Tomcat</p>

<p>Logging - logback,slf4j</p>

<p>而且我不用担心这个些依赖项之间的版本兼容性</p>

<h4 id="6spring-boot-还提供了其它的哪些-starter-project-options">6、Spring Boot 还提供了其它的哪些 Starter Project Options</h4>

<p>Spring Boot 也提供了其它的启动器项目包括，包括用于开发特定类型应用程序的典型依赖项。</p>

<p>spring-boot-starter-web-services - SOAP Web Services</p>

<p>spring-boot-starter-web - Web 和 RESTful 应用程序</p>

<p>spring-boot-starter-test - 单元测试和集成测试</p>

<p>spring-boot-starter-jdbc - 传统的 JDBC</p>

<p>spring-boot-starter-hateoas - 为服务添加 HATEOAS 功能</p>

<p>spring-boot-starter-security - 使用 SpringSecurity 进行身份验证和授权</p>

<p>spring-boot-starter-data-jpa - 带有 Hibeernate 的 Spring Data JPA</p>

<p>spring-boot-starter-data-rest - 使用 Spring Data REST 公布简单的 REST 服务</p>

<h4 id="7spring-是如何快速创建产品就绪应用程序的">7、Spring 是如何快速创建产品就绪应用程序的</h4>

<p><strong>Spring Boot 致力于快速产品就绪应用程序。为此，它提供了一些譬如高速缓存，日志记录，监控和嵌入式服务器等开箱即用的非功能性特征。</strong></p>

<p>spring-boot-starter-actuator - 使用一些如监控和跟踪应用的高级功能</p>

<p>spring-boot-starter-undertow, spring-boot-starter-jetty, spring-boot-starter-tomcat - 选择您的特定嵌入式 Servlet 容器</p>

<p>spring-boot-starter-logging - 使用 logback 进行日志记录</p>

<p>spring-boot-starter-cache - 启用 Spring Framework 的缓存支持</p>

<h4 id="8创建一个-spring-boot-project-的最简单的方法是什么">8、创建一个 Spring Boot Project 的最简单的方法是什么</h4>

<p>Spring Initializr是启动 Spring Boot Projects 的一个很好的工具</p>

<h4 id="9spring-initializr-是创建-spring-boot-projects-的唯一方法吗">9、Spring Initializr 是创建 Spring Boot Projects 的唯一方法吗？</h4>

<p>Spring Initializr，还有通过maven创建</p>

<h4 id="10为什么我们需要-spring-boot-maven-plugin">10、为什么我们需要 spring-boot-maven-plugin?</h4>

<ul>
  <li>
    <p>spring-boot-maven-plugin 提供了一些像 jar 一样打包或者运行应用程序的命令。</p>
  </li>
  <li>spring-boot:run 运行你的 SpringBooty 应用程序。</li>
  <li>spring-boot：repackage 重新打包你的 jar 包或者是 war 包使其可执行</li>
  <li>spring-boot：start 和 spring-boot：stop 管理 Spring Boot 应用程序的生命周期（也可以说是为了集成测试）。</li>
  <li>spring-boot:build-info 生成执行器可以使用的构造信息。</li>
</ul>

<h4 id="11如何使用-springboot-自动重装我的应用程序">11、如何使用 SpringBoot 自动重装我的应用程序？</h4>

<p>把下面的依赖项添加至你的 Spring Boot Project pom.xml 中</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;dependency&gt;
     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
     &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
     &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre></div></div>

<p>重启应用程序，然后就可以了。</p>

<h4 id="12什么是嵌入式服务器我们为什么要使用嵌入式服务器呢">12、什么是嵌入式服务器？我们为什么要使用嵌入式服务器呢?</h4>

<p>思考一下在你的虚拟机上部署应用程序需要些什么。</p>

<p>第一步： 安装 Java</p>

<p>第二部： 安装 Web 或者是应用程序的服务器（Tomat/Wbesphere/Weblogic 等等）</p>

<p>第三部： 部署应用程序 war 包</p>

<p>如果我们想简化这些步骤，应该如何做呢？</p>

<p>让我们来思考如何使服务器成为应用程序的一部分？</p>

<blockquote>
  <p>你只需要一个安装了 Java 的虚拟机，就可以直接在上面部署应用程序了，
是不是很爽？</p>
</blockquote>

<p>这个想法是嵌入式服务器的起源。</p>

<p>当我们创建一个可以部署的应用程序的时候，我们将会把服务器（例如，tomcat）嵌入到可部署的服务器中。</p>

<blockquote>
  <p>例如，对于一个 Spring Boot 应用程序来说，你可以生成一个包含 Embedded Tomcat 的应用程序 jar。你就可以想运行正常 Java 应用程序一样来运行 web 应用程序了。</p>
</blockquote>

<p>嵌入式服务器就是我们的可执行单元包含服务器的二进制文件</p>

<h4 id="13如何在-spring-boot-中添加通用的-js-代码">13、如何在 Spring Boot 中添加通用的 JS 代码？</h4>

<p>在源文件夹下，创建一个名为 static 的文件夹。然后，你可以把你的静态的内容放在这里面。</p>

<p>例如，myapp.js 的路径是 resources\static\js\myapp.js</p>

<p>你可以参考它在 jsp 中的使用方法</p>

<script src="/js/myapp.js"></script>

<h4 id="14错误hal-browser-gives-me-unauthorized-error---full-authenticaition-is-required-to-access-this-resource该如何来修复这个错误呢">14、错误：HAL browser gives me unauthorized error - Full authenticaition is required to access this resource.该如何来修复这个错误呢？</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "timestamp": 1488656019562,
  "status": 401,
  "error": "Unauthorized",
  "message": "Full authentication is required to access this resource.",
  "path": "/beans"
}
</code></pre></div></div>

<p>两种方法：</p>

<h5 id="方法-1关闭安全验证">方法 1：关闭安全验证</h5>

<p>application.properties</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>management.security.enabled:FALSE
</code></pre></div></div>

<h5 id="方法二在日志中搜索密码并传递至请求标头中">方法二：在日志中搜索密码并传递至请求标头中</h5>

<h4 id="15什么是-spring-date">15、什么是 Spring Date</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Spring Data的使命是为数据访问提供熟悉且一致的基于Spring的编程模型，同时仍保留底层数据存储的特​​殊特性。
它使数据访问技术，关系数据库和非关系数据库，map-reduce框架和基于云的数据服务变得简单易用。这是一个伞形项目，其中包含许多特定于给定数据库的子项目。这些项目是通过与这些激动人心的技术背后的许多公司和开发人员合作开发的。
</code></pre></div></div>

<p><strong>主要模块</strong>
Spring Data主要使用的一些模块，根据需要选择对应的一些功能模块。</p>

<ul>
  <li>Spring Data common- 支持每个Spring Data模块的Core Spring概念。</li>
  <li>Spring Data JDBC- 对JDBC的Spring Data存储库支持。</li>
  <li>Spring Data JPA - 对JPA的Spring Data存储库支持。</li>
  <li>Spring Data MongoDB - 对MongoDB的基于Spring对象文档的存储库支持。</li>
  <li>Spring Data Redis - 从Spring应用程序轻松配置和访问Redis。</li>
  <li>Spring Data JDBC Ext- 支持标准JDBC的数据库特定扩展，包括对Oracle RAC快速连接故障转移的支持，AQ JMS支持以及对使用高级数据类型的支持。</li>
  <li>Spring Data KeyValue - Map基于库和SPI轻松建立键值存储一个Spring数据模块。</li>
  <li>Spring Data LDAP - 对Spring LDAP的 Spring Data存储库支持。</li>
  <li>Spring Data REST- 将Spring Data存储库导出为超媒体驱动的RESTful资源。</li>
  <li>Spring Data for Pivotal GemFire - 轻松配置和访问Pivotal GemFire，实现高度一致，低延迟/高吞吐量，面向数据的Spring应用程序。</li>
  <li>Spring Data for Apache Cassandra- 轻松配置和访问Apache Cassandra或大规模，高可用性，面向数据的Spring应用程序。</li>
  <li>Spring Data for Apace Geode- 轻松配置和访问Apache Geode，实现高度一致，低延迟，面向数据的Spring应用程序。</li>
  <li>Spring Data for Apache Solr- 为面向搜索的Spring应用程序轻松配置和访问Apache Solr。</li>
</ul>

<h4 id="16什么是-spring-data-rest">16、什么是 Spring Data REST</h4>

<p>Spring Data REST是基于Spring Data的repository之上，可以把 repository <strong>自动</strong> 输出为REST资源，目前支持Spring Data JPA、Spring Data MongoDB、Spring Data Neo4j、Spring Data GemFire、Spring Data Cassandra的 repository <strong>自动</strong> 转换成REST服务。</p>

<h4 id="17当-spring-boot-应用程序作为-java-应用程序运行时后台会发生什么">17、当 Spring Boot 应用程序作为 Java 应用程序运行时，后台会发生什么？</h4>

<p>当你启动 java 应用程序的时候，spring boot 自动配置文件就会魔法般的启用了。</p>

<ul>
  <li>当 Spring Boot 应用程序检测到你正在开发一个 web 应用程序的时候，它就会启动 tomcat。</li>
</ul>

<h4 id="18我们能否在-spring-boot-starter-web-中用-jetty-代替-tomcat">18、我们能否在 spring-boot-starter-web 中用 jetty 代替 tomcat？</h4>

<p>在 spring-boot-starter-web 移除现有的依赖项，并把下面这些添加进去。</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;exclusions&gt;</span>
        <span class="nt">&lt;exclusion&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/exclusion&gt;</span>
    <span class="nt">&lt;/exclusions&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-jetty<span class="nt">&lt;/artifactId&gt;</span>
<span class="err">&lt;</span>/dependency
</code></pre></div></div>

<h4 id="19如何使用-spring-boot-生成一个-war-文件">19、如何使用 Spring Boot 生成一个 WAR 文件？</h4>

<ol>
  <li>
    <packaging>war</packaging>
  </li>
  <li>
    <p>在pom.xml中加入build节点,build节点中的finalName可改成项目名称(包名)</p>
  </li>
  <li>
    <p>在spring-boot-starter-web依赖中移除tomcat模块：</p>
  </li>
  <li>
    <p>新建启动类：主要是SpringApplicationBuilder configure 方法</p>

    <p><a href="./0704-03">详情配置</a></p>
  </li>
</ol>

<h4 id="20如何使用-spring-boot-部署到不同的服务器">20、如何使用 Spring Boot 部署到不同的服务器？</h4>

<ul>
  <li>在一个项目中生成一个 war 文件。</li>
  <li>将它部署到你最喜欢的服务器（websphere 或者 Weblogic 或者 Tomcat and so on）。</li>
</ul>

<p>21、RequestMapping 和 GetMapping 的不同之处在哪里？</p>

<ul>
  <li>RequestMapping 具有类属性的，可以进行 GET,POST,PUT 或者其它的注释中具有的请求方法。</li>
  <li>GetMapping 是 GET 请求方法中的一个特例。它只是 ResquestMapping 的一个延伸，目的是为了提高清晰度</li>
</ul>

<h4 id="22为什么我们不建议在实际的应用程序中使用-spring-data-rest">22、为什么我们不建议在实际的应用程序中使用 Spring Data Rest?</h4>

<p>我们认为 Spring Data Rest 很适合快速原型制造！在大型应用程序中使用需要谨慎。</p>

<p>通过 Spring Data REST 你可以把你的数据实体作为 RESTful 服务直接发布。</p>

<p>当你设计 RESTful 服务器的时候，最佳实践表明，你的接口应该考虑到两件重要的事情：</p>

<ul>
  <li>你的模型范围。</li>
  <li>你的客户。</li>
  <li>Spring Data Rest 在做复杂数据库查询不适合</li>
</ul>

<p>通过 With Spring Data REST，你不需要再考虑这两个方面，只需要作为 TEST 服务发布实体。</p>

<p>这就是为什么我们建议使用 Spring Data Rest 在快速原型构造上面，或者作为项目的初始解决方法。对于完整演变项目来说，这并不是一个好的注意。</p>

<h4 id="23jpa-和-hibernate-有哪些区别">23、JPA 和 Hibernate 有哪些区别？</h4>

<ul>
  <li>JPA 是一个规范或者接口</li>
  <li>Hibernate 是 JPA 的一个实现
<img src="/assets/images/mianshiti/0704/1436045-20180817162031268-1675607816.png" alt="1" /></li>
</ul>

<h4 id="24业务边界应该从哪一层开始">24、业务边界应该从哪一层开始？</h4>

<p>我们建议在服务层管理业务。商业业务逻辑在商业层或者服务层，与此同时，你想要执行的业务管理也在该层。</p>

<h4 id="25使用-spring-boot-启动连接到内存数据库-h2-的-jpa-应用程序需要哪些依赖项">25、使用 Spring Boot 启动连接到内存数据库 H2 的 JPA 应用程序需要哪些依赖项？</h4>

<p>在 Spring Boot 项目中，当你确保下面的依赖项都在类路里面的时候，你可以加载 H2 控制台。</p>

<ul>
  <li>web 启动器</li>
  <li>h2</li>
  <li>jpa 数据启动器</li>
</ul>

<h4 id="26如何不通过任何配置来选择-hibernate-作为-jpa-的默认实现">26、如何不通过任何配置来选择 Hibernate 作为 JPA 的默认实现？</h4>

<p>因为 Spring Boot 是自动配置的。</p>

<p>下面是我们添加的依赖项</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;dependency&gt;
     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
     &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre></div></div>

<p>spring-boot-stater-data-jpa 对于 Hibernate 和 JPA 有过渡依赖性。</p>

<p>当 Spring Boot 在类路径中检测到 Hibernate 中，将会自动配置它为默认的 JPA 实现</p>

<h4 id="27指定的数据库连接信息在哪里它是如何知道自动连接至-h2-的">27、指定的数据库连接信息在哪里？它是如何知道自动连接至 H2 的？</h4>

<p>这就是 Spring Boot 自动配置的魔力。</p>

<p>来自：https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-auto-configuration.html</p>

<p>Spring Boot auto-configuration 试图自动配置你已经添加的基于 jar 依赖项的 Spring 应用程序。比如说，如果 HSQLDBis 存在你的类路径中，并且，数据库连接 bean 还没有手动配置，那么我们可以自动配置一个内存数据库。</p>

<p>进一步的阅读：</p>

<p>http://www.springboottutorial.com/spring-boot-auto-configuration</p>

<h4 id="28我们如何连接一个像-mysql-或者-orcale-一样的外部数据库">28、我们如何连接一个像 MYSQL 或者 orcale 一样的外部数据库？</h4>

<p>让我们以 MySQL 为例来思考这个问题：</p>

<h5 id="第一步---把-mysql-连接器的依赖项添加至-pomxml">第一步 - 把 mysql 连接器的依赖项添加至 pom.xml</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre></div></div>

<h5 id="第二步---从-pomxml-中移除-h2-的依赖项">第二步 - 从 pom.xml 中移除 H2 的依赖项</h5>

<p>或者至少把它作为测试的范围。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;!--
&lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
&lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
--&gt;   
</code></pre></div></div>

<h5 id="第三步---安装你的-mysql-数据库">第三步 - 安装你的 MySQL 数据库</h5>

<p>更多的来看看这里 -https://github.com/in28minutes/jpa-with-hibernate#installing-and-setting-up-mysql</p>

<h5 id="第四步---配置你的-mysql-数据库连接">第四步 - 配置你的 MySQL 数据库连接</h5>

<p>配置 application.properties</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring.jpa.hibernate.ddl-auto=none
spring.datasource.url=jdbc:mysql://localhost:3306/todo_example
spring.datasource.username=todouser
spring.datasource.password=YOUR_PASSWORD   
</code></pre></div></div>

<h5 id="第五步---重新启动你就准备好了">第五步 - 重新启动，你就准备好了！</h5>

<p>就是这么简单！</p>

<h4 id="29spring-boot-配置的默认-h2-数据库的名字是上面为什么默认的数据库名字是-testdb">29、Spring Boot 配置的默认 H2 数据库的名字是上面？为什么默认的数据库名字是 testdb？</h4>

<p>在 application.properties 里面，列出了所有的默认值</p>

<ul>
  <li>https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html</li>
</ul>

<p>找到下面的属性</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring.datasource.name=testdb # Name of the datasource.
</code></pre></div></div>

<p>如果你使用了 H2 内部存储数据库，它里面确定了 Spring Boot 用来安装你的 H2 数据库的名字。</p>

<h4 id="30你能否举一个以-readonly-为事务管理的例子">30、你能否举一个以 ReadOnly 为事务管理的例子？</h4>

<ul>
  <li>当你从数据库读取内容的时候，你想把事物中的用户描述或者是其它描述设置为只读模式，以便于 Hebernate 不需要再次检查实体的变化。这是非常高效的。</li>
</ul>

<p><a href="./0704/03">Spring事务管理的两种方式</a><br />
<a href="./0704/05">只读事务（@Transactional(readOnly = true)）的一些概念</a></p>

<h4 id="31发布-spring-boot-用户应用程序自定义配置的最好方法是什么">31、发布 Spring Boot 用户应用程序自定义配置的最好方法是什么？</h4>

<p>@Value 的问题在于，您可以通过应用程序分配你配置值。更好的操作是采取集中的方法。
你可以使用 @ConfigurationProperties 定义一个配置组件。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="s">"basic"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicConfiguration</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>
</code></pre></div></div>

<p>你可以在 application.properties 中配置参数。</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>basic.value: true
basic.message: Dynamic Message
basic.number: 100
</code></pre></div></div>

<h4 id="32配置文件的需求是什么">32、配置文件的需求是什么？</h4>

<p>企业应用程序的开发是复杂的，你需要混合的环境：</p>

<ul>
  <li>Dev</li>
  <li>QA</li>
  <li>Stage</li>
  <li>Production</li>
</ul>

<p>在每个环境中，你想要不同的应用程序配置。</p>

<blockquote>
  <p>配置文件有助于在不同的环境中进行不同的应用程序配置。</p>
</blockquote>

<p>Spring 和 Spring Boot 提供了你可以制定的功能。</p>

<ul>
  <li>不同配置文件中，不同环境的配置是什么？</li>
  <li>为一个制定的环境设置活动的配置文件。</li>
</ul>

<p>Spring Boot 将会根据特定环境中设置的活动配置文件来选择应用程序的配置</p>

<h4 id="33如何使用配置文件通过-spring-boot-配置特定环境的配置">33、如何使用配置文件通过 Spring Boot 配置特定环境的配置？</h4>

<p>配置文件不是设别环境的关键。</p>

<p>在下面的例子中，我们将会用到两个配置文件</p>

<ul>
  <li>dev</li>
  <li>prod</li>
</ul>

<p>缺省的应用程序配置在 application.properties 中。让我们来看下面的例子：</p>

<p>application.properties</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>basic.value= true
basic.message= Dynamic Message
basic.number= 100
</code></pre></div></div>

<p>我们想要为 dev 文件自定义 application.properties 属性。我们需要创建一个名为 application-dev.properties 的文件，并且重写我们想要自定义的属性。</p>

<p>application-dev.properties</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>basic.message: Dynamic Message in DEV
</code></pre></div></div>

<p>一旦你特定配置了配置文件，你需要在环境中设定一个活动的配置文件。</p>

<p>有多种方法可以做到这一点：</p>

<ul>
  <li>在 VM 参数中使用 Dspring.profiles.active=prod</li>
  <li>在 application.properties 中使用 spring.profiles.active=prod</li>
</ul>
</div><p><a href="/mianshi/SpringBoot/0704">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E9%9D%A2%E8%AF%95%E9%A2%98">面试题</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jul 04, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="mianshi-2020-07-04-03">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-07-04T00:00:00+08:00">
    <meta itemprop="keywords" content="面试题"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/mianshi/SpringBoot/0704-02"><h2 itemprop="headline" class="item__header">Spring Boot自动配置实现原理</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><p>我们在使用Spring Boot构建Java Web项目的时候，实现起来非常的简单，那么SpringBoot是如何做到看似简单，却能够实现我们之前使用SSM或者SSH结合复杂配置实现的功能的呢？</p>

<p>我们在看Spring Boot的介绍的时候，常看到下面一段话：Spring Boot 是由 Pivotal 团队提供的全新框架，其__设计目的是用来简化新 Spring 应用的初始搭建以及开发过程__。<strong>该框架使用了特定的方式来进行配置，从而使开发人员不再需要定义样板化的配置</strong>。<strong>Spring Boot采用约定大约配置的方式，大量的减少了配置文件的使用</strong>。那么，Spring Boot是如何做到约定大于配置的呢？</p>

<p>首先我们看一下Spring Boot的主程序功能，也就是Spring Boot官方文档里面写的，你可以直接run</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>
 
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
 
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>一个非常简单的run方法的执行，加上@SpringBootApplication的注解，我们看一下run方法的源代码：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringApplication</span><span class="o">{</span>
      <span class="o">......</span>
 
    <span class="kd">public</span> <span class="nc">ConfigurableApplicationContext</span> <span class="nf">run</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//监控任务执行时间</span>
		<span class="nc">StopWatch</span> <span class="n">stopWatch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StopWatch</span><span class="o">();</span>
		<span class="n">stopWatch</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">//创建应用上下文</span>
		<span class="nc">ConfigurableApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="c1">//用来记录关于启动的错误报告</span>
		<span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">SpringBootExceptionReporter</span><span class="o">&gt;</span> <span class="n">exceptionReporters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="n">configureHeadlessProperty</span><span class="o">();</span>
        <span class="c1">//可以监听springboot应用启动过程中的一些生命周期事件</span>
		<span class="nc">SpringApplicationRunListeners</span> <span class="n">listeners</span> <span class="o">=</span> <span class="n">getRunListeners</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
		<span class="n">listeners</span><span class="o">.</span><span class="na">starting</span><span class="o">();</span>
		<span class="k">try</span> <span class="o">{</span>
            <span class="c1">//程序运行参数</span>
			<span class="nc">ApplicationArguments</span> <span class="n">applicationArguments</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultApplicationArguments</span><span class="o">(</span>
					<span class="n">args</span><span class="o">);</span>
            <span class="c1">//加载相关的配置文件</span>
			<span class="nc">ConfigurableEnvironment</span> <span class="n">environment</span> <span class="o">=</span> <span class="n">prepareEnvironment</span><span class="o">(</span><span class="n">listeners</span><span class="o">,</span>
					<span class="n">applicationArguments</span><span class="o">);</span>
			<span class="n">configureIgnoreBeanInfo</span><span class="o">(</span><span class="n">environment</span><span class="o">);</span>
            <span class="c1">//打印Banner,也就是springboot启动后最开始打印的图像</span>
			<span class="nc">Banner</span> <span class="n">printedBanner</span> <span class="o">=</span> <span class="n">printBanner</span><span class="o">(</span><span class="n">environment</span><span class="o">);</span>
            <span class="c1">//真正的创建应用上下文</span>
			<span class="n">context</span> <span class="o">=</span> <span class="n">createApplicationContext</span><span class="o">();</span>
			<span class="n">exceptionReporters</span> <span class="o">=</span> <span class="n">getSpringFactoriesInstances</span><span class="o">(</span>
					<span class="nc">SpringBootExceptionReporter</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
					<span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="nc">ConfigurableApplicationContext</span><span class="o">.</span><span class="na">class</span> <span class="o">},</span> <span class="n">context</span><span class="o">);</span>
			<span class="n">prepareContext</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">environment</span><span class="o">,</span> <span class="n">listeners</span><span class="o">,</span> <span class="n">applicationArguments</span><span class="o">,</span>
					<span class="n">printedBanner</span><span class="o">);</span>
			<span class="n">refreshContext</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
			<span class="n">afterRefresh</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">applicationArguments</span><span class="o">);</span>
			<span class="n">stopWatch</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">logStartupInfo</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">new</span> <span class="nf">StartupInfoLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mainApplicationClass</span><span class="o">)</span>
						<span class="o">.</span><span class="na">logStarted</span><span class="o">(</span><span class="n">getApplicationLog</span><span class="o">(),</span> <span class="n">stopWatch</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="n">listeners</span><span class="o">.</span><span class="na">started</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
			<span class="n">callRunners</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">applicationArguments</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">handleRunFailure</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">ex</span><span class="o">,</span> <span class="n">exceptionReporters</span><span class="o">,</span> <span class="n">listeners</span><span class="o">);</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
		<span class="o">}</span>
 
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">listeners</span><span class="o">.</span><span class="na">running</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">handleRunFailure</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">ex</span><span class="o">,</span> <span class="n">exceptionReporters</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">context</span><span class="o">;</span>
	<span class="o">}</span>
 
    <span class="o">......</span>
<span class="o">}</span>

</code></pre></div></div>

<p>在上面这段run方法的源代码当中，有一个context = createApplicationContext();方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="nc">ConfigurableApplicationContext</span> <span class="nf">createApplicationContext</span><span class="o">()</span> <span class="o">{</span>
		<span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">contextClass</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">applicationContextClass</span><span class="o">;</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">contextClass</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="k">switch</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">webApplicationType</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">case</span> <span class="nl">SERVLET:</span>
                    <span class="c1">//假如是servlet应用，默认加载DEFAULT_WEB_CONTEXT_CLASS</span>
					<span class="n">contextClass</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="no">DEFAULT_WEB_CONTEXT_CLASS</span><span class="o">);</span>
					<span class="k">break</span><span class="o">;</span>
				<span class="k">case</span> <span class="nl">REACTIVE:</span>
					<span class="n">contextClass</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="no">DEFAULT_REACTIVE_WEB_CONTEXT_CLASS</span><span class="o">);</span>
					<span class="k">break</span><span class="o">;</span>
				<span class="k">default</span><span class="o">:</span>
					<span class="n">contextClass</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="no">DEFAULT_CONTEXT_CLASS</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">ClassNotFoundException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span>
						<span class="s">"Unable create a default ApplicationContext, "</span>
								<span class="o">+</span> <span class="s">"please specify an ApplicationContextClass"</span><span class="o">,</span>
						<span class="n">ex</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="o">(</span><span class="nc">ConfigurableApplicationContext</span><span class="o">)</span> <span class="nc">BeanUtils</span><span class="o">.</span><span class="na">instantiateClass</span><span class="o">(</span><span class="n">contextClass</span><span class="o">);</span>
	<span class="o">}</span>

</code></pre></div></div>

<p>也就是说，<strong>通过一个简单的run方法，将引发的是一系列复杂的内部调用和加载过程，从而初始化一个应用所需的配置、环境、资源以及各种自定义的类。在这个阶段，会导入一些列自动配置的类，实现强大的自动配置的功能</strong>。那么自动配置类是从哪里来的呢？这就需要@SpringBootApplicaton起到作用了。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Documented</span>
<span class="nd">@Inherited</span>
<span class="nd">@SpringBootConfiguration</span>
<span class="nd">@EnableAutoConfiguration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">excludeFilters</span> <span class="o">=</span> <span class="o">{</span>
		<span class="nd">@Filter</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">CUSTOM</span><span class="o">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="nc">TypeExcludeFilter</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
		<span class="nd">@Filter</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">CUSTOM</span><span class="o">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="nc">AutoConfigurationExcludeFilter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">})</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">SpringBootApplication</span> <span class="o">{</span>
     <span class="o">......</span>
<span class="o">}</span>
</code></pre></div></div>

<p>其中，<strong>@ComponentScan将扫描和加载一些自定义的类</strong>，<strong>@EnableAutoConfiguration将导入一些自动配置的类</strong>。这些自动配置的类很多，并且他们都处于org.springframework.boot.autoconfigure这个包下面。这些配置类都会被导入并处于备用状态。假如你在maven文件当中引入了相关的包的时候，相关功能将被启用。</p>

<p>那么，我们说的springboot约定大于配置是什么意思呢？自动配置在加载一个类的时候，会首先去读取项目当中的配置文件，假如没有，就会启用默认值，这就是springboot约定大于配置原理。以Thymeleaf为例：看下下面我们就知道，为什么我们使用Thymeleaf模板引擎，html文件默认放在resources下面的templates文件夹下面，因为这是Thymeleaf的默认配置。</p>

<p>@ConfigurationProperties(prefix = “spring.thymeleaf”)
public class ThymeleafProperties {</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">"spring.thymeleaf"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThymeleafProperties</span> <span class="o">{</span>
 
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Charset</span> <span class="no">DEFAULT_ENCODING</span> <span class="o">=</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">;</span>
 
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">DEFAULT_PREFIX</span> <span class="o">=</span> <span class="s">"classpath:/templates/"</span><span class="o">;</span>
 
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">DEFAULT_SUFFIX</span> <span class="o">=</span> <span class="s">".html"</span><span class="o">;</span>
 
	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">checkTemplate</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
 
	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">checkTemplateLocation</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
 
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">prefix</span> <span class="o">=</span> <span class="no">DEFAULT_PREFIX</span><span class="o">;</span>
 
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">suffix</span> <span class="o">=</span> <span class="no">DEFAULT_SUFFIX</span><span class="o">;</span>
 
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">"HTML"</span><span class="o">;</span>
 
	<span class="kd">private</span> <span class="nc">Charset</span> <span class="n">encoding</span> <span class="o">=</span> <span class="no">DEFAULT_ENCODING</span><span class="o">;</span>
 
	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">cache</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
 
    <span class="o">......</span>
<span class="o">}</span>

</code></pre></div></div>
<p>}
并且这些约定的配置一般都以Properties为结尾，比如</p>

<p>org.springframework.boot.autoconfigure.jdbc.DataSourceProperties（数据库连接配置）</p>

<p>org.springframework.boot.autoconfigure.data.redis.RedisProperties（Redis连接配置）</p>

<p>org.springframework.boot.autoconfigure.amqp.RabbitProperties（RabbitMQ连接配置）</p>

<p>org.springframework.boot.autoconfigure.web.ResourceProperties（Web资源配置）</p>

<p>org.springframework.boot.autoconfigure.kafka.KafkaProperties（Kafka连接配置）</p>

<p>org.springframework.boot.autoconfigure.cache.CacheProperties（缓存配置）</p>

<p>那么，我们知道程序会自动装配加载很多类，但是我们假如不想程序去加载某些类（毕竟加载需要耗时），我们如何去自定义我们想加载的配置类呢？</p>

<p>我们只需要把@SpringBootApplication注解去掉，换成@Congfiguation注解，并通过@Import注解去指定需要加载的配置类就可以了（非常不建议这么做，因为我们可能不是特别了解所有自动加载的类的特性）。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">({</span>
		<span class="nc">DispatcherServletAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="nc">HttpEncodingAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="nc">ThymeleafAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="nc">WebMvcAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="nc">WebSocketServletAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="nc">MultipartAutoConfiguration</span><span class="o">.</span><span class="na">class</span>
		<span class="c1">//继续加载你需要的配置</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>
 
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
 
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

</div><p><a href="/mianshi/SpringBoot/0704-02">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E9%9D%A2%E8%AF%95%E9%A2%98">面试题</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jul 04, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="mianshi-2020-07-04-04">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-07-04T00:00:00+08:00">
    <meta itemprop="keywords" content="面试题"></div>
      </article></div>
</div><div class="layout--home"><div class="pagination"><p>276 post articles, 35 pages.</p>
    <div class="pagination__menu">
      <ul class="menu menu--nowrap"><li><div class="button button--secondary button--circle disabled">
            <i class="fas fa-angle-left"></i>
          </div></li><li>
              <div class="button button--primary button--circle focus"><span>1</span></div>
            </li><li>
                  <a class="button button--secondary button--circle" href="/home/page2"><span>2</span></a>
                </li><li>
                  <a class="button button--secondary button--circle" href="/home/page3"><span>3</span></a>
                </li><li>
                  <a class="button button--secondary button--circle" href="/home/page4"><span>4</span></a>
                </li><li><span class="pagination__omit"><i class="fas fa-ellipsis-h"></i></span></li><li>
                  <a class="button button--secondary button--circle" href="/home/page35"><span>35</span></a>
                </li><li><a class="button button--secondary button--circle" href="/home/page2">
            <i class="fas fa-angle-right"></i>
          </a></li></ul>
    </div>
  </div></div>
<script>/*(function () {

})();*/
</script>



</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="java牛牛"><meta itemprop="url" content="/javaniuniu.com"><meta itemprop="description" content="I am an amazing person.
"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><link itemprop="url" href="javaniuniu.com"><li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:king101125s@gmail.com" target="_blank">
        <i class="fas fa-envelope"></i>
      </a><li title="Follow me on Facebook.">
        <a class="button button--circle facebook-button" itemprop="sameAs" href="https://www.facebook.com/minplemon" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M767.428571 6.857143l0 150.857143-89.714286 0q-49.142857 0-66.285714 20.571429t-17.142857 61.714286l0 108 167.428571 0-22.285714 169.142857-145.142857 0 0 433.714286-174.857143 0 0-433.714286-145.714286 0 0-169.142857 145.714286 0 0-124.571429q0-106.285714 59.428571-164.857143t158.285714-58.571429q84 0 130.285714 6.857143z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://twitter.com/minplemon" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M1024.032 194.432c-37.664 16.704-78.176 28-120.672 33.088 43.36-26.016 76.672-67.168 92.384-116.224-40.608 24.064-85.568 41.568-133.408 50.976-38.336-40.832-92.928-66.336-153.344-66.336-116.032 0-210.08 94.048-210.08 210.08 0 16.48 1.856 32.512 5.44 47.872-174.592-8.768-329.408-92.416-433.024-219.52-18.08 31.04-28.448 67.104-28.448 105.632 0 72.896 37.088 137.184 93.472 174.88-34.432-1.088-66.816-10.528-95.168-26.272-0.032 0.864-0.032 1.76-0.032 2.656 0 101.792 72.416 186.688 168.512 205.984-17.632 4.8-36.192 7.36-55.36 7.36-13.536 0-26.688-1.312-39.52-3.776 26.72 83.456 104.32 144.192 196.256 145.888-71.904 56.352-162.496 89.92-260.928 89.92-16.96 0-33.664-0.992-50.112-2.944 92.96 59.616 203.392 94.4 322.048 94.4 386.432 0 597.728-320.128 597.728-597.76 0-9.12-0.192-18.176-0.608-27.168 41.056-29.632 76.672-66.624 104.832-108.736z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/javaniuniu" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© JAVA 牛牛 2020, <a href="http://www.beian.miit.gov.cn/">浙ICP备20011288号</a>
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  window.Lazyload.js(['https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js', 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js'], function() {
    var $canvas = null, $this = null, _ctx = null, _text = '';
    $('.language-chart').each(function(){
      $this = $(this);
      $canvas = $('<canvas></canvas>');
      _text = $this.text();
      $this.text('').append($canvas);
      _ctx = $canvas.get(0).getContext('2d');
      (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
    });
  });
</script>
<script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};_config.TeX = { equationNumbers: { autoNumber: "all" } };MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  window.Lazyload.js('https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js', function() {
    mermaid.initialize({
      startOnLoad: true
    });
    mermaid.init(undefined, '.language-mermaid');
  });
</script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

