<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Home - JAVA 牛牛</title>

<meta name="description" content="">
<link rel="canonical" href="http://localhost:4000/home/"><link rel="alternate" type="application/rss+xml" title="JAVA 牛牛" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://use.fontawesome.com/releases/v5.0.13/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3,h4,h5,h6'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="256px" height="256px" viewBox="0 0 256 256" enable-background="new 0 0 256 256" xml:space="preserve">  <image id="image0" width="256" height="256" x="0" y="0"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAABGdBTUEAALGPC/xhBQAAACBjSFJN
AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABklBMVEX///99Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9
Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxd9Fxf///9O0pOeAAAAhHRS
TlMAAAQjKwgXLxOD7/efFFPXuzPDGHf7S4uvN/Mko3MwXN+rQGu/LH+nII8MsyiX6+NMx1hjtzhg
R8+Te1Bn518nb0PbHzuHENPLPDRo2IRXxT+bZEhUGz1ExCL60NwVoU9bHA/JYmyu6fFyaaLUrH2V
gAH1Ei1RQloHgakFtNUDduLohQ2rommNAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAALEwAACxMBAJqc
GAAAAAd0SU1FB+QFDgsyHesd3D4AABK2SURBVHja7V35V9tIEkbOOATbYMfYAQxMbHB8cNgh8YA5
TAgB48AsC4Fs9gZm7/u+71394WtzuD/JLanVXZLIG9UPeS9G6q761Ed1XT00FFJIIYUUUkghfWlJ
k6XIg0+i0i+T08PhR3IvygIQHYnpejwxGrTgNzSW1HU99dhHAKJp/ZqS40HL3qPMDTPZJ/4BMKHf
0mTQwndp6o6ZmMSAlAMgmrvrU58OWnxNm+kzM+sXAJ/2u9SfBi2+puX7zBT8AmCOATAftPiaFu8z
U/QLgGcMgFLQ4msaY6bsFwAV1mc1aPG1BcZMwi8ARlmfi0HLry0xZpb9AkCr9fusBy2/9pwBkPEN
gBXWaSVoADKMlxe+AbDMOn0ZNAANxstnvgGwyjqV2HpIKcKUsuyCbwCMMwCC1gXXGCdNiddlT4NJ
pb2HksqMk3UfAdhg3WaXgpR/nOmB+qaPAIAqpKeCBGCE8RGXMdBIW4RSgMBWcPLjAJA6mksDAOqH
Hh8ODICCrjYD5AHQmtB1K6idYBuYyEf8BQCHgJ58FYj8UzngQUIPVgJAm0QEWo8DkP9VCzmQ0ILU
AKjEEYHsju/yv44hA5KWGQUAtC3dQCuPfRU/OpI1TEKpFUANAFTCbvYh/yCIjO0aus5KnIPUAVhI
mhDQkxtTrr7Emy49dN/x3kjd1PGErAxKAGjjLX2A4s1CYqLkRNXJdJ5N4Vq+WN53fOea9hMzzfhA
pynJCaAKgLbEQSAASralJVAEQFuqq7OvTC2F45gqANr4QdDi67sqx1FlALSFRMDyd5QctOoAaNpq
TF0KeUqoRSlQAKCNz6jLIUl1qSMgNQCa9rYYiPjxCfnlnxYATTssxNUFcke5KkF4BhkAmjZ6VPQR
g3jqKUmIEiEAXYrOlcrNnJgEtYNiOdHVGauJxGQxKfjSjezNQmmOKkCLFoBbWqhUKmOfWwpQn/zK
8TPz6X30cHti0Xo7+epJ5ZaI47I8AaB7WCtl+YLkT1/YOROXVss1/ou5bW849QaABytcIZobIjrb
ZyO73LcLnsTkeQLAMW9Gt/bFLaeHy7zJUJ/6OACIVDnMFzfdHVij7zhnjKwHAUn0ALSLg5xPfirR
0BmnoYT0ud83AF4lacTv0dwgBEVl1c9jAPYGFvEVWWtdj84H1kPq4FxiAPbMy19NMZAykjFrl3Va
H4waAO+HT55sb2+/zHT/2X5y8mbVzG1CfcRWzPOg9bWpk+PtW1o7GZYwqioDEB0+HimvONoDa8+V
xe/RvJOeXF8pjxwPyynH7gEYnj8VtII1qDSXpaZQfweJefduancAvNmaFLb+ZAmDaKPCZrfY5NYb
rwAYHkmKstGl3Ac6+bu0lRXvOjniYiCIAvBmY1ecgy7lqQOHPrg5MOu7JdFxIARAZKzhSvrudKRP
pXHrgymOCWmNAgC0M67dP2k5X70DAu7GYHe/zAhswo4APKy6N3p/3Qv5Ne0b33TLSK7qqCQ4ANCu
Spj5vuWN/Jo2656XeNVhL7YFIJqRcXl8+zseyW8IChSmWMZWQ7IDYM1+0mXzxXI1s7r6Yu67+HPL
y1TCNcNesHG+urqzn3AyqeYvpAB4v2jTZKF0/qy/yBqChXLPPJTfFJuW78+1yvPZso1+uvjePQDz
VqM/uWw2axbxz+eeyq9pJezMGB3d3qx2LJjOWdqSLAAYb/BHfXpn0LB3iU+MeCy/puHAzD42/3X0
XYO/bDcsBgEfgDWubbpzxFtR26glpMlNVoP9YUhGmvPAwtMij/vamjAAkX3O+7H1Qz5D+HDMjwSi
t3gsuOQ+Utnn6W77vK/DAaDNGf6tHau9/QpH3KoP8kPmdpd2Lfa4yCpnC0txNMNBADhWzd131lsp
HlR9yiGMIoeWAaqRzUErAiekeQCAvYHBE5u3mdjTMB5zV/4AoL3FsWmj5jwdiOBq7TkBcGHWKRxi
EHAAyIVryxBGpNjFKEc3zJt5bswegDGz3WHF/lyPCRu7/pUUuYLPZJ8mcGVW57ImBIwAmOXPzTts
a7geqUbruCFUhy7tHzWHcJkQMABglr/jtKtFoXGZpD1pakPHHYdnR1N2CCAAeyb5q45aDWas+DkA
NG0Hej50eNYcrJDFlRAAGDaufzkBiSAMwNcBYBwCzknzH4xbWw6MpgyAceOeURewakIhCd9riYAC
mnNefaeNyk2dHdn7AESNBymh+FOwT9S9PwQYaRyG9YXz46Npo3h9zPoAGF0PYlZN0Db9LyUCGYMi
GZORgkHAfsLzHQDbEvJDMZ3sle8AnLHe4yLsmhC4i7m6BWDJsAAWxKyasBkHkT4Ma5aQE9aIQG4a
AYgYzg1pQZUO9oB3AQAAoUinQi9EGihlMwIAGOxMSUGnLpSSyQZRVQ6ORIKVXBYMZsMSA2AJFQXh
PODzYGeApsHmLuiJNCR53dQ9uAagiD+/Fe0fhqBEETMCgo1LNIz0ED918Q6AYxwY4mfapusPQEwv
OLuaE6EKrR/fABDNw2/iRp0FBmYtEPmxksuB8EuY8t07wA8ZQamJr2aH7C07ReTR5fJKPpZPTm64
CHSNvN5v7NZb+VT1wm5HAkVM2BZhMGLv9ACI4i8uSjFtGdqxoGHMI9ndEWPzYQms8rn1B5YPgmHI
6UTICNbunj1tyDAA3Fg119lrVtEwo+ZkqvqYc7uRHbMFY8QKN2DdRT0r1Id2tKEIKFRxN2b9BnvP
Yt5McbJKl50OTeOpwZeaFoPgA3tkX5xxNOTXI0O4BbhKwWYHzBb/gTGuj6por2aPcwOxWvyoJ1gF
Cy44Ryf78RAcE2OuwjrZJrDC/ftri7iuht0YGLUIRGvx42PZCcbJLobUhiUmPQS91AQXqWu6Yu/N
8P5esYytsKtB2bB66YA7cJhq29KEKbKNU3PI0E1LHAKwBnE9wkXdkvYsG92xfokLG9i8hcU/NjqM
hkz91PbfizUEhWV5u+CltSjWWkvbJiIny0s6AGVYTIGJbptdhkODPRX2RJoCPZTnErWN7rUyYZXs
XuJNNDAMimxgDzcGncZDvPAakThLKKnIUQPeGtqrFzuGFdHi8BgxsJdLFw0DgnfkBsSc0zJOypxt
KTZkMe2K8w5TAQCYG/wrlNzUm72/tw1Fb/jjFWaVntvqrkaRc4SEo+tkbJlAelDK6zzaGdKsUhz1
zoZdzPGWbd+wm93ZF8+h6WNuk2jpvp3xaKvnVE22/wpM+g2L2KFsqXcYesbPcrweIJM7ViCU7PqO
sj8y7fKU/cjX22BN78c0gekzKQXAwtqEZZD7yuGtQWTVrhJKLr3+cvgLU7PDW9+z6xtqHRf6P4IR
mas5wOEOXB3sx6wtAFsc/er9xUTaOsy+9a73yo1NMFpyCgmNHSz2qgNtzZZK64sHxpVzEACYzWBg
YbzwK9GyWbrCfoTz1KCIGeAiXtx/+frN9cr16M3e2Oxy0SIL+fbx0o3ee+cXaDtCYE2iADhVgecC
AFv9IAAlEfa44vdrLzDfYLskWxTp+wOMgZrIRvs0+5FfBR6mAJMVDLmDb0gCEK9yfIOaRb6uAP1g
gDEo+B7r9wVGVP6xs8Ee6Bs5p9hvu4NvnDryxqHYCPo9TSEyc2WJ8HiOXxA23cXbr3kCyxHflQzh
Jq1bCwCWa+MY3srOzJnp4Mh43BmIEhud77htk/M98dOkesJEtnDh5LueYcvTW9fq8h7uYJxw36JL
TuPlgfWKFyk6XXKXnMKZ0WeGBzqJScOKzAtw7VLU8FC9UDZs4Dz/q5s0tm63R0KBkte0lEm7aHjw
/YgthFYBpVW7l3imZxfzNZ3hH5es8wXa58uCAPM8c6s2z+9a2YTG7QTi2H1HdTHKLb67sujSIWdo
dHMiJaAfcASK2Kwk1sFHG9Yv8ZTHT3VnyqXsS+4IpM1dne2sLzYRh1qzUNr8Ifs/zzP2zDKNxcaN
ZQ1bnXeAPGd/T6UG+2s1qu8c81dcpM6OV5bmujRdiZi/FveTnluIsmJnFq5YKGM57nEfWHje5e/D
6sZE4pomSqvPn4lFecjXDwAB+c7hee45pGkffcXPD83xXdagBki7Z+UBgAl4yn9ikzMLGk7fpcIx
puUtzD1swmQDKKoK6q6VUX7a7OWJCZSfju6bR86Mlb+CbRpJ53bJAQB1N275zCYaW2ITYimF0wnY
DrPWNWjgyCV/6x9NcXWbtXY6s9hDKtdZ3hR3u7RXEwddELLJwpENZmCYlk9WUwAAXGwSFxwREBye
5LMVFQCAbSCYG9dghZG/4EEBADBwrAQCANtkcvKNqNQRYsqh1P0uqgT7sMJtVyoAgBlbpVyWLIFn
Qrq2vBoAYJHz/3oJg7lUIVtFBQBIZQ/i9l0wu10FA0AbdBz/5Ye7rvIKzSgVUwO1XbZkoDxBhoPK
dW9KAFSDXARgCVAJ1lcCYJPx0PAdAPBnBna/ACwCvmsCcBJyESBFDAD6rWhrpzkT1BSaUWlHDQAI
aVDQRaQIDgJKZRvUAIBYVXmThBQtgMkgwCs2osCGvzfujbGO1ZJ2FavKNhgf/qbNQNyEizhpegCO
GB9ptZbcUQTciMJJTl4AABHDvqbOQQhKTS1rWbWwMmjDft7BDTqo0iaoDkBA6bOgBioWL1MF4NNA
5gBE4golTnsIAGZu+TcHYAaoWiKUAQDjuG/30GNUtWrlCmUA0Ed/5RMAa3QzgKC8PsyBDZ8AmKGb
AQQAwBzw6TyA5wDl2i3qAGApGfH8TRUCY1hOuYIvwQ0ToAutq7cmQBDApqgF0QAAOScxP+xCEItP
YIYhAAAr+nh0H5aBwClMUL2I4pIVOBP7oArgQZDADEUBwDmMSW/LKvcITCEUlSsoAEDFzPtlME07
3kjuGcJ0L+qboMyEmidFEVsSAHBd9uA+NANBRiLJnkNz0xTYqD3WBttx4ulGAwD4yERq2ylQhnYJ
pAIA63B4uhNixRcadyTRZWv4Ybz0lNMXMSUCYBSmZlm9OUsCZ2SepoYl1XV7kCWV9c5HdAEDgCgi
gQoA3AlVAjbsCQ6eMaKrbMguXJz0YQiAKUzRIeYBAFj9wKvI2SKATHWXDd2Vm5DuE7/yRP4TL6YZ
HQCbXrBnoI4Xs4zw0tWmF/wBXXiCMCEAOAS80AUwmYhO2aK8dheT7+mLbKIhhDAylxIAHAI/ylPT
j73RtkkvXha7HFadKNdYUgDO1GUTIdIllvbq7aIvAJxSskwLwGcuLseVphjphYbEl6//xAcAfkrK
MTEAEreCuqYV0sssaAEYl6/G5IJI/W+0AFTVpROgXcohQArAgqvrseVJoDxzMABAJp9+UJSnA44i
iIUVKHPUSAEogvzU1+7g/RiU6SmUALRBCxC69sQVYY0dwvQUjw5D4vX+xQmquROG5lMCAE5iLwLm
wOp4ej8BAMOwF94hKFRKmKRHCQA7DRvy+SOXi7udqnOlYiNN/eznn//izPAT22QJ/Y+UALBsZkzj
Wbjxnefcbd6/vGnoV/z27z0AyOBdtaO4m/Ch79+19OuPHgAW0lIQb+k3fXf7b3/3sQOQYeqLeEu/
Z+vdHz52ACCmR9yQ8Uf20tbHDgBkuYtf4RICEAIQAhACEAIQAhACEAIQAhACEAIQAhACEAIQAhAC
EAIQAhACEALwsQIAlZbEW3rMXvrTxw4AKznootran1mw1QOH9u89ACzNwU3MxF/uXvor/Oh0X+E9
AgA/9vStm8tVltPf/n7z0j+gPBeUcC3cTwAsrmMfXc7pesdlnuc///VvXf/Pf/8HP0EoNmFWFiUA
kENu8oJdyST5PTQ1AkGIR/cTAG8LTWOC9j1NmHjKOPQgSApypnKEMXiUAEB9TYurlVUI0lEoU7JI
AyWhvkmLurriS0BXsYikdwDgPeYp2lDRVxCGXKOsV0UKQBuj5VOEY2BhG0OFqfKm6QHA0nrdD1Xd
o5H+ctJwE2X8HqfMjJoSJurV14oz4ZFJel3lWi3vAeBcNVqbufxCtrUHs8XBLKw8UeUEbwDAwmp9
yqYzU64HwsKTdf7NtWduW/IXgPE8l2s9NrkzLC7869KKVQIe6QroAQDaknXaTC61f/He6f1PLtc7
NtmHi9SJGOQAaG9ruh3F0uvzT15xdvKFTy5mEx2HrKM07QLgCQDaksjF3a2DYvm0dEMjiZlisibw
kj5D/f09AUAbLYgI455iW+q8+QKApj2vq4trpt0NUgXIWwC0yIdToTEtLP2IVxXKPAKAFIPmBn1B
Dh8A6GHwdl/wAntLiqfmr7xk0VsAejQ934jLSp9f3iTf9nwHoEvROWvFzpJi5SNfbi7yA4AeLZxt
LArn1idnjjyc9cEAcE1LLyYW7TfIbLM8+8HryrzBAXBN7cPz2eVGJ280cuTThYmd50v0mt79A6BP
kUqX5uYOK5Wr4JjQhkIKKaSQQgoppC8t/R/dov80OkxKRAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAy
MC0wNS0xNFQxMTo1MDoyOSswMDowMIfyupMAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjAtMDUtMTRU
MTE6NTA6MjkrMDA6MDD2rwIvAAAAAElFTkSuQmCC" />
</svg>
<a title="主要是想看下自己还能在多做些什么
" href="/">JAVA 牛牛</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item navigation__item--active"><a href="/home/">Home</a></li><li class="navigation__item"><a href="/module.html">模块</a></li><li class="navigation__item"><a href="/leetcode/all">leetcode(力扣)</a></li><li class="navigation__item"><a href="/algo/all">algo(算法)</a></li><li class="navigation__item"><a href="/docker/about">Docker</a></li><li class="navigation__item"><a href="/todo">TODO</a></li><li class="navigation__item"><a href="/pm">PM</a></li><li class="navigation__item"><a href="/archive.html">Archive</a></li><li class="navigation__item"><a href="/about.html">About</a></li><li class="navigation__item"><a href="https://github.com/javaniuniu">GitHub</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/WebPage"><header style="display:none;"><h1>Home</h1></header><meta itemprop="headline" content="Home"><meta itemprop="author" content="java牛牛"/><div class="js-article-content"><div class="layout--articles"><div class="article-list items items--divided"><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/mysql/partition"><h2 itemprop="headline" class="item__header">Mysql 分区表-分区操作</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><h3 id="视频参考链接">视频参考链接</h3>
<p><a href="https://www.bilibili.com/video/BV1E7411q7Nx?p=1">MySQL分区</a></p>

<h3 id="一查看mysql是否支持分区">一、查看MySQL是否支持分区</h3>
<h4 id="1mysql56以及之前版本">1、MySQL5.6以及之前版本</h4>

<p>show variables like ‘%partition%’;</p>

<p><img src="/assets/images/mysql/0620/1530782-20181221101618516-1766491003.png" alt="1" /></p>

<h4 id="2mysql57">2、MySQL5.7</h4>

<p>show plugins;</p>

<p><img src="/assets/images/mysql/0620/1530782-20181221101735004-398510033.png" alt="2" /></p>

<h3 id="二分区表的分类与限制">二、分区表的分类与限制</h3>
<h4 id="1分区表分类">1、分区表分类</h4>

<p><strong>RANGE分区</strong>：基于属于一个给定连续区间的列值，把多行分配给分区。</p>

<p><strong>LIST分区</strong>：类似于按RANGE分区，区别在于LIST分区是基于列值匹配一个离散值集合中的某个值来进行选择。</p>

<p><strong>HASH分区</strong>：基于用户定义的表达式的返回值来进行选择的分区，该表达式使用将要插入到表中的这些行的列值进行计算。这个函数可以包含MySQL 中有效的、产生非负整数值的任何表达式。</p>

<p><strong>KEY分区</strong>：类似于按HASH分区，区别在于KEY分区只支持计算一列或多列，且MySQL服务器提供其自身的哈希函数。必须有一列或多列包含整数值。</p>

<p><strong>复合分区</strong>：在MySQL 5.6版本中，只支持RANGE和LIST的子分区，且子分区的类型只能为HASH和KEY。</p>

<h4 id="2分区表限制">2、分区表限制</h4>

<p>1）分区键必须包含在表的所有主键、唯一键中。</p>

<p>2）MYSQL只能在使用分区函数的列本身进行比较时才能过滤分区，而不能根据表达式的值去过滤分区，即使这个表达式就是分区函数也不行。</p>

<p>3）最大分区数： 不使用NDB存储引擎的给定表的最大可能分区数为8192（包括子分区）。如果当分区数很大，但是未达到8192时提示 Got error … from storage engine: Out of resources when opening file,可以通过增加open_files_limit系统变量的值来解决问题，当然同时打开文件的数量也可能由操作系统限制。</p>

<p>4）不支持查询缓存： 分区表不支持查询缓存，对于涉及分区表的查询，它自动禁用。 查询缓存无法启用此类查询。</p>

<p>5）分区的innodb表不支持外键。</p>

<p>6）服务器SQL_mode影响分区表的同步复制。 主机和从机上的不同SQL_mode可能会导致sql语句; 这可能导致分区之间的数据分配给定主从位置不同，甚至可能导致插入主机上成功的分区表在从库上失败。 为了获得最佳效果，您应该始终在主机和从机上使用相同的服务器SQL模式。</p>

<p>7）ALTER TABLE … ORDER BY： 对分区表运行的ALTER TABLE … ORDER BY列语句只会导致每个分区中的行排序。</p>

<p>8）全文索引。 分区表不支持全文索引，即使是使用InnoDB或MyISAM存储引擎的分区表。  <br />
9）分区表无法使用外键约束。  <br />
10）Spatial columns： 具有空间数据类型（如POINT或GEOMETRY）的列不能在分区表中使用。 <br />
11）临时表： 临时表不能分区。  <br />
12）subpartition问题： subpartition必须使用HASH或KEY分区。 只有RANGE和LIST分区可能被分区; HASH和KEY分区不能被子分区。 <br />
13）分区表不支持mysqlcheck，myisamchk和myisampack。</p>

<h3 id="三创建分区表">三、创建分区表</h3>
<h4 id="1range分区">1、range分区</h4>

<p>1）行数据基于一个给定的连续区间的列值放入分区。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`test_11`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`t`</span> <span class="nb">date</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">,</span><span class="nv">`t`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span>
 <span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">RANGE</span> <span class="p">(</span><span class="n">to_days</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="p">(</span><span class="n">PARTITION</span> <span class="n">p20170801</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">736907</span><span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">,</span>
 <span class="n">PARTITION</span> <span class="n">p20170901</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">736938</span><span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">,</span>
 <span class="n">PARTITION</span> <span class="n">pmax</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="k">maxvalue</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">);</span><span class="mi">123456789</span>
</code></pre></div></div>

<p>2）然后插入4条数据：</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">insert</span> <span class="k">into</span> <span class="n">test_11</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">"20170722"</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="nv">"20170822"</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="nv">"20170823"</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="nv">"20170824"</span><span class="p">);</span><span class="mi">1</span>
</code></pre></div></div>
<p>3）然后查看information下partitions对分区别信息的统计：</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">PARTITION_NAME</span> <span class="k">as</span> <span class="nv">"分区"</span><span class="p">,</span><span class="n">TABLE_ROWS</span> <span class="k">as</span> <span class="nv">"行数"</span> <span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">partitions</span> <span class="k">where</span> <span class="n">table_schema</span><span class="o">=</span><span class="nv">"mysql_test"</span> <span class="k">and</span> <span class="k">table_name</span><span class="o">=</span><span class="nv">"test_11"</span><span class="p">;</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-----------+--------+
| 分区      | 行数   |
+-----------+--------+
| p20170801 |      1 |
| p20170901 |      3 |
+-----------+--------+
2 rows in set (0.00 sec)12345678
</code></pre></div></div>
<p>可以看出分区p20170801插入1行数据，p20170901插入的3行数据。
可以是用year、to_days、unix_timestamp等函数对相应的时间字段进行转换，然后分区。</p>
<h3 id="2list分区">2、list分区</h3>

<p>和range分区一样，只是list分区面向的是离散的值</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">h2</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="n">c1</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="o">-&gt;</span>   <span class="n">c2</span> <span class="nb">INT</span>
    <span class="o">-&gt;</span> <span class="p">)</span>
    <span class="o">-&gt;</span> <span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">LIST</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="n">PARTITION</span> <span class="n">p0</span> <span class="k">VALUES</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="o">-&gt;</span>   <span class="n">PARTITION</span> <span class="n">p1</span> <span class="k">VALUES</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">11</span> <span class="n">sec</span><span class="p">)</span><span class="mi">123456789</span>
</code></pre></div></div>
<p>与RANGE分区的情况不同，没有“catch-all”，如MAXVALUE; 分区表达式的所有预期值应在PARTITION … VALUES IN（…）子句中涵盖。 包含不匹配的分区列值的INSERT语句失败并显示错误，如此示例所示：</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">h2</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1525</span> <span class="p">(</span><span class="n">HY000</span><span class="p">):</span> <span class="k">Table</span> <span class="n">has</span> <span class="k">no</span> <span class="n">partition</span> <span class="k">for</span> <span class="n">value</span> <span class="mi">312</span>
</code></pre></div></div>
<h4 id="3hash分区">3、hash分区</h4>

<p>根据用户自定义表达式的返回值来进行分区，返回值不能为负数</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="p">(</span><span class="n">col1</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">col2</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">col3</span> <span class="nb">DATE</span><span class="p">)</span>
    <span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">HASH</span><span class="p">(</span> <span class="nb">YEAR</span><span class="p">(</span><span class="n">col3</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">PARTITIONS</span> <span class="mi">4</span><span class="p">;</span><span class="mi">123</span>
</code></pre></div></div>
<p>如果你插入col3的数值为’2005-09-15’，那么根据以下计算来选择插入的分区：</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">MOD</span><span class="p">(</span><span class="nb">YEAR</span><span class="p">(</span><span class="s1">'2005-09-01'</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
    <span class="o">=</span>  <span class="k">MOD</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="o">=</span>  <span class="mi">1123</span>
</code></pre></div></div>
<h4 id="4key分区">4、key分区</h4>

<p>根据MySQL数据库提供的散列函数进行分区</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">k1</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">PARTITION</span> <span class="k">BY</span> <span class="k">KEY</span><span class="p">()</span>
<span class="n">PARTITIONS</span> <span class="mi">2</span><span class="p">;</span><span class="mi">1234567</span>
</code></pre></div></div>
<p>KEY仅列出零个或多个列名称。 用作分区键的任何列必须包含表的主键的一部分或全部，如果该表具有一个。 如果没有列名称作为分区键，则使用表的主键（如果有）。如果没有主键，但是有一个唯一的键，那么唯一键用于分区键。但是，如果唯一键列未定义为NOT NULL，则上一条语句将失败。
与其他分区类型不同，KEY使用的分区不限于整数或空值。 例如，以下CREATE TABLE语句是有效的：</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tm1</span> <span class="p">(</span>
    <span class="n">s1</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span>
<span class="p">)</span>
<span class="n">PARTITION</span> <span class="k">BY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="n">PARTITIONS</span> <span class="mi">10</span><span class="p">;</span><span class="mi">12345</span>
</code></pre></div></div>
<p>注意：对于key分区表，不能执行ALTER TABLE DROP PRIMARY KEY，因为这样做会生成错误 ERROR 1466 (HY000): Field in list of fields for partition function not found in table.</p>
<h4 id="5column分区">5、Column分区</h4>

<p>COLUMN分区是5.5开始引入的分区功能，只有RANGE COLUMN和LIST COLUMN这两种分区；支持整形、日期、字符串；RANGE和LIST的分区方式非常的相似。
COLUMNS和RANGE和LIST分区的区别
1）针对日期字段的分区就不需要再使用函数进行转换了，例如针对date字段进行分区不需要再使用YEAR()表达式进行转换。  <br />
2）COLUMN分区支持多个字段作为分区键但是不支持表达式作为分区键。</p>

<h5 id="column支持的数据类型">column支持的数据类型：</h5>

<p>1）所有的整型，float和decimal不支持  <br />
2）日期类型：date和datetime，其他不支持  <br />
3）字符类型：CHAR, VARCHAR, BINARY和VARBINARY，blob和text不支持 <br />
单列的column range分区mysql&gt; show create table list_c;</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`list_c`</span> <span class="p">(</span>
  <span class="nv">`c1`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`c2`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">latin1</span>
<span class="cm">/*!50500 PARTITION BY RANGE  COLUMNS(c1)
(PARTITION p0 VALUES LESS THAN (5) ENGINE = InnoDB,
 PARTITION p1 VALUES LESS THAN (10) ENGINE = InnoDB) */</span>
</code></pre></div></div>
<p>多列的column range分区mysql&gt; show create table list_c;</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`list_c`</span> <span class="p">(</span>
  <span class="nv">`c1`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`c2`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`c3`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">latin1</span>
<span class="cm">/*!50500 PARTITION BY RANGE  COLUMNS(c1,c3)
(PARTITION p0 VALUES LESS THAN (5,'aaa') ENGINE = InnoDB,
 PARTITION p1 VALUES LESS THAN (10,'bbb') ENGINE = InnoDB) */</span>
<span class="err">单列的</span><span class="k">column</span> <span class="n">list</span><span class="err">分区</span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">create</span> <span class="k">table</span> <span class="n">list_c</span><span class="p">;</span>
 <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`list_c`</span> <span class="p">(</span>
  <span class="nv">`c1`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`c2`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`c3`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">latin1</span>
<span class="cm">/*!50500 PARTITION BY LIST  COLUMNS(c3)
(PARTITION p0 VALUES IN ('aaa') ENGINE = InnoDB,
 PARTITION p1 VALUES IN ('bbb') ENGINE = InnoDB) */</span>
</code></pre></div></div>
<h4 id="6子分区组合分区">6、子分区（组合分区）</h4>

<p>在分区的基础上再进一步分区，有时成为复合分区;
MySQL数据库允许在range和list的分区上进行HASH和KEY的子分区。例如：</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">ts</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">purchased</span> <span class="nb">DATE</span><span class="p">)</span>
    <span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">RANGE</span><span class="p">(</span> <span class="nb">YEAR</span><span class="p">(</span><span class="n">purchased</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">SUBPARTITION</span> <span class="k">BY</span> <span class="n">HASH</span><span class="p">(</span> <span class="n">TO_DAYS</span><span class="p">(</span><span class="n">purchased</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">SUBPARTITIONS</span> <span class="mi">2</span> <span class="p">(</span>
        <span class="n">PARTITION</span> <span class="n">p0</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">1990</span><span class="p">),</span>
        <span class="n">PARTITION</span> <span class="n">p1</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">2000</span><span class="p">),</span>
        <span class="n">PARTITION</span> <span class="n">p2</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="k">MAXVALUE</span>
    <span class="p">);</span>
</code></pre></div></div>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mycat-3 ~]# ll /data/mysql_data_3306/mysql_test/ts*
-rw-r----- 1 mysql mysql  8596 Aug  8 13:54 /data/mysql_data_3306/mysql_test/ts.frm
-rw-r----- 1 mysql mysql 98304 Aug  8 13:54 /data/mysql_data_3306/mysql_test/ts#P#p0#SP#p0sp0.ibd
-rw-r----- 1 mysql mysql 98304 Aug  8 13:54 /data/mysql_data_3306/mysql_test/ts#P#p0#SP#p0sp1.ibd
-rw-r----- 1 mysql mysql 98304 Aug  8 13:54 /data/mysql_data_3306/mysql_test/ts#P#p1#SP#p1sp0.ibd
-rw-r----- 1 mysql mysql 98304 Aug  8 13:54 /data/mysql_data_3306/mysql_test/ts#P#p1#SP#p1sp1.ibd
-rw-r----- 1 mysql mysql 98304 Aug  8 13:54 /data/mysql_data_3306/mysql_test/ts#P#p2#SP#p2sp0.ibd
-rw-r----- 1 mysql mysql 98304 Aug  8 13:54 /data/mysql_data_3306/mysql_test/ts#P#p2#SP#p2sp1.ibd
1234567891011121314151617
</code></pre></div></div>
<p>ts表根据purchased进行range分区，然后又进行了一次hash分区，最后形成了3*2个分区，可以从物理文件证实此分区方式。可以通过subpartition语法来显示指定子分区名称。
注意：每个子分区的数量必须相同；如果一个分区表的任何子分区已经使用subpartition，那么必须表明所有的子分区名称；每个subpartition子句必须包括子分区的一个名字；子分区的名字必须是一致的
另外，对于MyISAM表可以使用index directory和data direactory来指定各个分区的数据和索引目录，但是对于innodb表来说，因为该存储引擎使用表空间自动的进行数据和索引的管理，因此会忽略指定index和data的语法。</p>

<h3 id="四普通表转换为分区表">四、普通表转换为分区表</h3>
<p>1、用alter table table_name partition by命令重建分区表</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">alter</span> <span class="k">table</span> <span class="n">jxfp_data_bak</span> <span class="n">PARTITION</span> <span class="k">BY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">SH</span><span class="p">)</span> <span class="n">PARTITIONS</span> <span class="mi">8</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="五分区表操作">五、分区表操作</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">year_col</span> <span class="nb">INT</span>
<span class="p">)</span>
<span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">RANGE</span> <span class="p">(</span><span class="n">year_col</span><span class="p">)</span> <span class="p">(</span>
    <span class="n">PARTITION</span> <span class="n">p0</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">1991</span><span class="p">),</span>
    <span class="n">PARTITION</span> <span class="n">p1</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">1995</span><span class="p">),</span>
    <span class="n">PARTITION</span> <span class="n">p2</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">1999</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>
<h4 id="1add-partition-新增分区">1、ADD PARTITION （新增分区）</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="k">ADD</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="n">p3</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">2002</span><span class="p">));</span>
</code></pre></div></div>
<h4 id="2drop-partition-删除分区">2、DROP PARTITION （删除分区）</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="k">DROP</span> <span class="n">PARTITION</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">;</span>
</code></pre></div></div>
<h4 id="3truncate-partition截取分区">3、TRUNCATE PARTITION（截取分区）</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="k">TRUNCATE</span> <span class="n">PARTITION</span> <span class="n">p0</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="k">TRUNCATE</span> <span class="n">PARTITION</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p3</span><span class="p">;</span>
</code></pre></div></div>
<h4 id="4coalesce-partition合并分区">4、COALESCE PARTITION（合并分区）</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t2</span> <span class="p">(</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">started</span> <span class="nb">DATE</span>
<span class="p">)</span>
<span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">HASH</span><span class="p">(</span> <span class="nb">YEAR</span><span class="p">(</span><span class="n">started</span><span class="p">)</span> <span class="p">)</span>
<span class="n">PARTITIONS</span> <span class="mi">6</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t2</span> <span class="n">COALESCE</span> <span class="n">PARTITION</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div>
<h4 id="5reorganize-partition拆分重组分区">5、REORGANIZE PARTITION（拆分/重组分区）</h4>

<h5 id="1拆分分区">1）拆分分区</h5>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span><span class="p">,</span> <span class="n">REORGANIZE</span> <span class="n">PARTITION</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">employees</span> <span class="k">ADD</span> <span class="n">PARTITION</span> <span class="p">(</span>
    <span class="n">PARTITION</span> <span class="n">p5</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">2010</span><span class="p">),</span>
    <span class="n">PARTITION</span> <span class="n">p6</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="k">MAXVALUE</span>
<span class="p">);</span>
</code></pre></div></div>
<h5 id="2重组分区">2）重组分区</h5>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">members</span> <span class="n">REORGANIZE</span> <span class="n">PARTITION</span> <span class="n">s0</span><span class="p">,</span><span class="n">s1</span> <span class="k">INTO</span> <span class="p">(</span>
    <span class="n">PARTITION</span> <span class="n">p0</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">1970</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tbl_name</span>
    <span class="n">REORGANIZE</span> <span class="n">PARTITION</span> <span class="n">partition_list</span>
    <span class="k">INTO</span> <span class="p">(</span><span class="n">partition_definitions</span><span class="p">);</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">members</span> <span class="n">REORGANIZE</span> <span class="n">PARTITION</span> <span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span> <span class="k">INTO</span> <span class="p">(</span>
    <span class="n">PARTITION</span> <span class="n">m0</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">1980</span><span class="p">),</span>
    <span class="n">PARTITION</span> <span class="n">m1</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tt</span> <span class="k">ADD</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="n">np</span> <span class="k">VALUES</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tt</span> <span class="n">REORGANIZE</span> <span class="n">PARTITION</span> <span class="n">p1</span><span class="p">,</span><span class="n">np</span> <span class="k">INTO</span> <span class="p">(</span>
    <span class="n">PARTITION</span> <span class="n">p1</span> <span class="k">VALUES</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span>
    <span class="n">PARTITION</span> <span class="n">np</span> <span class="k">VALUES</span> <span class="k">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>
<h4 id="6analyze-check-partition分析与检查分区">6、ANALYZE 、CHECK PARTITION（分析与检查分区）</h4>

<p>1）ANALYZE 读取和存储分区中值的分布情况</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="k">ANALYZE</span> <span class="n">PARTITION</span> <span class="n">p1</span><span class="p">,</span> <span class="k">ANALYZE</span> <span class="n">PARTITION</span> <span class="n">p2</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="k">ANALYZE</span> <span class="n">PARTITION</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">;</span>
</code></pre></div></div>
<p>2）CHECK 检查分区是否存在错误</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="k">ANALYZE</span> <span class="n">PARTITION</span> <span class="n">p1</span><span class="p">,</span> <span class="k">CHECK</span> <span class="n">PARTITION</span> <span class="n">p2</span><span class="p">;</span>
</code></pre></div></div>
<h4 id="7repair分区">7、REPAIR分区</h4>

<p>修复被破坏的分区</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="n">REPAIR</span> <span class="n">PARTITION</span> <span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">;</span>
</code></pre></div></div>
<h4 id="8optimize">8、OPTIMIZE</h4>

<p>该命令主要是用于回收空闲空间和分区的碎片整理。对分区执行该命令,相当于依次对分区执行 CHECK PARTITION, ANALYZE PARTITION,REPAIR PARTITION命令。</p>

<p>譬如:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="n">OPTIMIZE</span> <span class="n">PARTITION</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">;</span>
</code></pre></div></div>
<h4 id="9rebuild分区">9、REBUILD分区</h4>

<p>重建分区,它相当于先删除分区中的数据,然后重新插入。这个主要是用于分区的碎片整理。</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="n">REBUILD</span> <span class="n">PARTITION</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">;</span>
</code></pre></div></div>
<h4 id="10exchange-partition分区交换">10、EXCHANGE PARTITION（分区交换）</h4>

<p>分区交换的语法如下:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">pt</span> <span class="n">EXCHANGE</span> <span class="n">PARTITION</span> <span class="n">p</span> <span class="k">WITH</span> <span class="k">TABLE</span> <span class="n">nt</span>
</code></pre></div></div>
<p>其中,pt是分区表,p是pt的分区(注:也可以是子分区),nt是目标表。</p>

<p>其实,分区交换的限制还是蛮多的:</p>

<p>1） nt不能为分区表</p>

<p>2）nt不能为临时表</p>

<p>3）nt和pt的结构必须一致</p>

<p>4）nt不存在任何外键约束,即既不能是主键,也不能是外键。</p>

<p>5）nt中的数据不能位于p分区的范围之外。</p>

<p>具体可参考MySQL的官方文档</p>

<h4 id="11迁移分区discard-import-">11、迁移分区（DISCARD 、IMPORT ）</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="n">DISCARD</span> <span class="n">PARTITION</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="n">TABLESPACE</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="n">IMPORT</span> <span class="n">PARTITION</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="n">TABLESPACE</span><span class="p">;</span>
</code></pre></div></div>
<p>实验环境：（都是mysql5.7）
源库：192.168.2.200      mysql5.7.16    zhangdb下的emp_2分区表的
目标库：192.168.2.100    mysql5.7.18    test下  （将zhangdb的emp表，导入到目标库的test schema下）
–：在源数据库中创建测试分区表emp_2，然后导入数据</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MySQL</span> <span class="p">[</span><span class="n">zhangdb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">emp_2</span><span class="p">(</span>
<span class="n">id</span> <span class="nb">BIGINT</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="n">x</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">y</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">RANGE</span> <span class="n">COLUMNS</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">(</span>
<span class="n">PARTITION</span> <span class="n">p1</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">1000</span><span class="p">),</span>  
<span class="n">PARTITION</span> <span class="n">p2</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">2000</span><span class="p">),</span>  
<span class="n">PARTITION</span> <span class="n">p3</span> <span class="k">VALUES</span> <span class="k">LESS</span> <span class="k">THAN</span> <span class="p">(</span><span class="mi">3000</span><span class="p">)</span>     
<span class="p">);</span>  
</code></pre></div></div>
<p>（接着创建存储过程，导入测试数据）</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELIMITER</span> <span class="o">//</span>
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">insert_batch</span><span class="p">()</span>
<span class="k">begin</span>
<span class="k">DECLARE</span> <span class="n">num</span> <span class="nb">INT</span><span class="p">;</span>
<span class="k">SET</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">WHILE</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">3000</span> <span class="k">DO</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">num</span><span class="o">%</span><span class="mi">10000</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">COMMIT</span><span class="p">;</span>
<span class="k">END</span> <span class="n">IF</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">emp_2</span> <span class="k">VALUES</span><span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="n">REPEAT</span><span class="p">(</span><span class="s1">'X'</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">REPEAT</span><span class="p">(</span><span class="s1">'Y'</span><span class="p">,</span> <span class="mi">500</span><span class="p">));</span>
<span class="k">SET</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="k">END</span> <span class="n">WHILE</span><span class="p">;</span>
<span class="k">COMMIT</span><span class="p">;</span>
<span class="k">END</span> <span class="o">//</span>
<span class="k">DELIMITER</span> <span class="p">;</span>
</code></pre></div></div>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">TABLE_NAME</span><span class="p">,</span><span class="n">PARTITION_NAME</span> <span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">partitions</span> <span class="k">where</span> <span class="n">table_schema</span><span class="o">=</span><span class="s1">'zhangdb'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------------+----------------+</span>
<span class="o">|</span> <span class="k">TABLE_NAME</span> <span class="o">|</span> <span class="n">PARTITION_NAME</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+----------------+</span>
<span class="o">|</span> <span class="n">emp</span>        <span class="o">|</span> <span class="k">NULL</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">emp_2</span>      <span class="o">|</span> <span class="n">p1</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">emp_2</span>      <span class="o">|</span> <span class="n">p2</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">emp_2</span>      <span class="o">|</span> <span class="n">p3</span>             <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="n">emp_2</span> <span class="n">partition</span> <span class="p">(</span><span class="n">p1</span><span class="p">);</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span>      <span class="mi">999</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="n">emp_2</span> <span class="n">partition</span> <span class="p">(</span><span class="n">p2</span><span class="p">);</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span>     <span class="mi">1000</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="n">emp_2</span> <span class="n">partition</span> <span class="p">(</span><span class="n">p3</span><span class="p">);</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span>     <span class="mi">1000</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>
<p>从上面可以看出，emp_2分区表已经创建完成，并且有3个子分区，每个分区都有一点数据。
–：在目标数据库中，创建emp_2表的结构，不要数据（要在源库，使用show create table emp_2\G 的方法 查看创建该表的sql）</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MySQL</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`emp_2`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="nv">`x`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`y`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">3000</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span>
<span class="cm">/*!50500 PARTITION BY RANGE  COLUMNS(id)
(PARTITION p1 VALUES LESS THAN (1000) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000) ENGINE = InnoDB) */</span> <span class="p">;</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost test]# ll
-rw-r----- 1 mysql mysql 98304 May 25 15:58 emp_2#P#p0.ibd
-rw-r----- 1 mysql mysql 98304 May 25 15:58 emp_2#P#p1.ibd
-rw-r----- 1 mysql mysql 98304 May 25 15:58 emp_2#P#p2.ibd
</code></pre></div></div>
<p>注意：
※约束条件、字符集等等也必须一致，建议使用show create table t1; 来获取创建表的SQL，否则在新服务器上导入表空间的时候会提示1808错误。
–：在目标数据库上，丢弃分区表的表空间</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MySQL</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">table</span> <span class="n">emp_2</span> <span class="n">discard</span> <span class="n">tablespace</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">12</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost test]# ll    ---这时候在看，刚才的3个分区的idb文件都没有了
-rw-r----- 1 mysql mysql  8604 May 25 04:14 emp_2.frm
</code></pre></div></div>
<p>–：在源数据库上运行FLUSH TABLES … FOR EXPORT 锁定表并生成.cfg元数据文件，最后将cfg和ibd文件传输到目标数据库中</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">flush</span> <span class="n">tables</span> <span class="n">emp_2</span> <span class="k">for</span> <span class="n">export</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost zhangdb]# scp emp_2* root@192.168.2.100:/mysql/data/test/   --将文件cp到目标数据库
mysql&gt; unlock tables;   ---最后将表的锁是否
</code></pre></div></div>
<p>–：在目标数据库中对文件授权，然后导入表空间查看数据是否完整可用</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span> <span class="n">test</span><span class="p">]</span><span class="o">#</span> <span class="n">chown</span> <span class="n">mysql</span><span class="p">.</span><span class="n">mysql</span> <span class="n">emp_2</span><span class="o">#*</span>
<span class="n">MySQL</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">table</span> <span class="n">emp_2</span> <span class="n">import</span> <span class="n">tablespace</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">96</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">MySQL</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="n">emp_2</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span>     <span class="mi">2999</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">63</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>
<p>从上面的查看得知，分区表都已经导入到目标数据库中了，
另外，也可以将部分子分区导入到目标数据库中，（往往整个分区表会很大，可用只将需要用到的子分区导入到目标数据库中），
将部分子分区导入到目标数据库的方法是：
1）在创建目标表的时候，只需要创建要导入的分区即可，如： 只创建了p2 p3两个分区</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`emp_2`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="nv">`x`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`y`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">3000</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span>
<span class="cm">/*!50500 PARTITION BY RANGE  COLUMNS(id)
(
 PARTITION p2 VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000) ENGINE = InnoDB) */</span>
</code></pre></div></div>
<p>2）从源库cp到目标库的文件，当然也就是这俩的，就不需要其他分区的了，
3）其他的操作方法都一样了。</p>

<h3 id="六如何获取分区的相关信息">六、如何获取分区的相关信息</h3>
<ol>
  <li>通过 SHOW CREATE TABLE 语句来查看分区表的分区子句</li>
</ol>

<p>譬如:mysql&gt; show create table e/G</p>

<ol>
  <li>通过 SHOW TABLE STATUS 语句来查看表是否分区对应Create_options字段</li>
</ol>

<p>譬如:
mysql&gt; show table status/G</p>

<p><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>* 1. row **</strong><strong>**</strong><strong>**</strong><strong>**</strong>*****</p>

<p>Name: e Engine: InnoDB Version: 10 Row_format: Compact Rows: 6 Avg_row_length: 10922 Data_length: 65536Max_data_length: 0 Index_length: 0 Data_free: 0 Auto_increment: NULL Create_time: 2015-12-07 22:26:06 Update_time: NULL Check_time: NULL Collation: latin1_swedish_ci Checksum: NULL Create_options: partitioned Comment:</p>

<ol>
  <li>
    <p>查看 INFORMATION_SCHEMA.PARTITIONS表</p>
  </li>
  <li>
    <p>通过 EXPLAIN PARTITIONS SELECT 语句查看对于具体的SELECT语句,会访问哪个分区。</p>
  </li>
</ol>

<h3 id="七mysql57对于partition表的改进">七、MySQL5.7对于partition表的改进</h3>
<ul>
  <li>HANDLER statements：MySQL 5.7.1分区表开始支持HANDLER语句；</li>
  <li>index condition pushdown：MySQL5.7.3分区表开始支持ICP；</li>
  <li>load data：MySQL5.7开始使用缓存来实现性能提升，每个分区使用130KB缓冲区来实现这一点；</li>
  <li>Per-partition索引缓存：MySQL5.7开始支持使用CACHE INDEX和LOAD INDEX INTO CACHE语句对分区的MyISAM表支持索引缓存；</li>
  <li>FOR EXPORT选项（FLUSH TABLES）:MySQL 5.7.4分区的InnoDB表开始支持FLUSH TABLES语句FOR EXPORT选项；</li>
  <li>从MySQL 5.7.2开始，子分区支持ANALYZE，CHECK，OPTIMIZE，REPAIR和TRUNCATE操作；</li>
</ul>
</div><p><a href="/mysql/partition">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=mysql">mysql</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jun 20, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="mysql-2020-06-20-01">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-06-20T00:00:00+08:00">
    <meta itemprop="keywords" content="mysql"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/spring/bean"><h2 itemprop="headline" class="item__header">Spring中Bean的作用域、生命周期</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><h3 id="bean的作用域">Bean的作用域</h3>
<p>　　Spring 3中为Bean定义了5中作用域，分别为singleton（单例）、prototype（原型）、request、session和global session，5种作用域说明如下：</p>
<ol>
  <li><strong>singleton</strong>：单例模式，Spring IoC容器中只会存在一个共享的Bean实例，无论有多少个Bean引用它，始终指向同一对象。Singleton作用域是Spring中的缺省作用域，也可以显示的将Bean定义为singleton模式，配置为：
<code class="language-plaintext highlighter-rouge">&lt;bean id="userDao" class="com.ioc.UserDaoImpl" scope="singleton"/&gt;</code></li>
  <li><strong>prototype</strong>:原型模式，每次通过Spring容器获取prototype定义的bean时，容器都将创建一个新的Bean实例，每个Bean实例都有自己的属性和状态，而singleton全局只有一个对象。根据经验，对有状态的bean使用prototype作用域，而对无状态的bean使用singleton作用域。</li>
  <li><strong>request</strong>：在一次Http请求中，容器会返回该Bean的同一实例。而对不同的Http请求则会产生新的Bean，而且该bean仅在当前Http Request内有效。
<code class="language-plaintext highlighter-rouge">&lt;bean id="loginAction" class="com.cnblogs.Login" scope="request"/&gt;</code> ，针对每一次Http请求，Spring容器根据该bean的定义创建一个全新的实例，且该实例仅在当前Http请求内有效，而其它请求无法看到当前请求中状态的变化，当当前Http请求结束，该bean实例也将会被销毁。</li>
  <li><strong>session</strong>：在一次Http Session中，容器会返回该Bean的同一实例。而对不同的Session请求则会创建新的实例，该bean实例仅在当前Session内有效。
<code class="language-plaintext highlighter-rouge">&lt;bean id="userPreference" class="com.ioc.UserPreference" scope="session"/&gt;</code>，同Http请求相同，每一次session请求创建新的实例，而不同的实例之间不共享属性，且实例仅在自己的session请求内有效，请求结束，则实例将被销毁。</li>
  <li><strong>global Session</strong>：在一个全局的Http Session中，容器会返回该Bean的同一个实例，仅在使用portlet context时有效。</li>
</ol>

<h3 id="bean的生命周期">Bean的生命周期</h3>
<p>　　经过如上对Bean作用域的介绍，接下来将在Bean作用域的基础上讲解Bean的生命周期。  <br />
　　Spring容器可以管理singleton作用域下Bean的生命周期，在此作用域下，Spring能够精确地知道Bean何时被创建，何时初始化完成，以及何时被销毁。而对于prototype作用域的Bean，Spring只负责创建，当容器创建了Bean的实例后，Bean的实例就交给了客户端的代码管理，Spring容器将不再跟踪其生命周期，并且不会管理那些被配置成prototype作用域的Bean的生命周期。Spring中Bean的生命周期的执行是一个很复杂的过程，读者可以利用Spring提供的方法来定制Bean的创建过程。Spring容器在保证一个bean实例能够使用之前会做很多工作：</p>

<p><img src="/assets/images/spring/0618/2018110145039276.png" alt="1" />
<img src="/assets/images/spring/0618/2018110145059598.png" alt="2" /></p>
</div><p><a href="/spring/bean">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=spring">spring</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jun 18, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="spring-bean">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-06-18T00:00:00+08:00">
    <meta itemprop="keywords" content="spring"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/java/io"><h2 itemprop="headline" class="item__header">在什么时候使用字节流、字符流</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><h3 id="总结性陈述">总结性陈述</h3>
<h4 id="字节流fileinputstream和fileoutputstream">字节流（FileInputStream和FileOutputStream）</h4>
<ol>
  <li>InputStream 和OutputStream,两个是为字节流设计的,主要用来处理字节或二进制对象</li>
  <li>字节流处理单元为 <code class="language-plaintext highlighter-rouge">1个字节</code>，操作字节和字节数组。</li>
  <li><strong>如果是音频文件、图片、歌曲，就用字节流好点，所以它对多国语言支持性比较好！</strong>
    <h4 id="字符流filereader和filewriter">字符流（FileReader和FileWriter）</h4>
  </li>
  <li>Reader和 Writer.两个是为字符流（一个字符占两个字节）设计的,主要用来处理字符或字符串.</li>
  <li>字符流处理的单元为 <code class="language-plaintext highlighter-rouge">2个字节</code> 的Unicode字符，操作字符、字符数组或字符串</li>
  <li>所以字符流是由Java虚拟机将字节转化为2个字节的Unicode字符为单位的字符而成的。</li>
  <li><strong>如果是关系到中文（文本）的，用字符流好点</strong></li>
</ol>

<h4 id="缓冲区的使用">缓冲区的使用</h4>
<ol>
  <li>
    <p>字节流在操作时不会用到缓冲区（内存），是直接对文件本身进行操作的。</p>
  </li>
  <li>
    <p>而字符流在操作时使用了缓冲区，通过缓冲区再操作文件。</p>
  </li>
  <li>
    <p>在硬盘上的所有文件都是以字节形式存在的（图片，声音，视频），而字符值在内存中才会形成。（重点）</p>
  </li>
</ol>

<h4 id="增添知识点">增添知识点</h4>
<p>文章重点：字节流在操作的时候本身是不会用到缓冲区（内存）的，是与文件本身直接操作的，而字符流在操作的时候是使用到缓冲区的。</p>

<p>字节流在操作文件时，即使不关闭资源（close方法），文件也能输出，但是如果字符流不使用close方法的话，则不会输出任何内容，说明字符流用的是缓冲区，并且可以使用flush方法强制进行刷新缓冲区，这时才能在不close的情况下输出内容。</p>

<p>但是节流是最基本的，一个字符占两个字节就可以看出，甚至源码使用字符流的时候，也是先转成字节在变成字符，所以使用字节流的操作是最多的。</p>

<h4 id="上面两点能说明什么呢">上面两点能说明什么呢？</h4>

<ol>
  <li>
    <p>第一点，所有文件的储存是都是字节（byte）的储存，在磁盘上保留的并不是文件的字符而是先把字符编码成字节，再储存这些字节到磁盘。
在读取文件（特别是文本文件）时，也是一个字节一个字节地读取以形成字节序列</p>
  </li>
  <li>
    <p>第二点，我们知道，如果一个程序频繁对一个资源进行IO操作，效率会非常低。此时，通过缓冲区，先把需要操作的数据暂时放入内存中，以后直接从内存中读取数据，则可以避免多次的IO操作，提高效率</p>
  </li>
  <li>
    <p>第三点，真正存储和传输数据时都是以字节为单位的，字符只是存在与内存当中的，所以，<strong>字节流适用范围更为宽广</strong></p>
  </li>
</ol>

<h3 id="概念">概念</h3>

<p>在程序中所有的数据都是以流的方式进行传输或保存的，程序需要数据的时候要使用输入流读取数据，而当程序需要将一些数据保存起来的时候，就要使用输出流完成。</p>

<p><strong>程序中的输入输出都是以流的形式保存的，流中保存的实际上全都是字节文件。</strong></p>

<h4 id="字节流与字符流">字节流与字符流</h4>

<p>在java.io包中操作文件内容的主要有两大类：字节流、字符流，两类都分为输入和输出操作。在字节流中输出数据主要是使用OutputStream完成，输入使的是InputStream，在字符流中输出主要是使用Writer类完成，输入流主要使用Reader类完成。（这四个都是抽象类）</p>

<h4 id="操作流程">操作流程</h4>

<p>在Java中IO操作也是有相应步骤的，以文件操作为例，主要的操作流程如下：</p>

<ol>
  <li>使用File类打开一个文件</li>
  <li>通过字节流或字符流的子类，指定输出的位置</li>
  <li>进行读/写操作</li>
  <li>关闭输入/输出</li>
  <li>IO操作属于资源操作，一定要记得关闭</li>
</ol>

<h4 id="字节流">字节流</h4>
<p>字节流主要是操作byte类型数据，以byte数组为准，主要操作类就是OutputStream、InputStream</p>

<h5 id="字节输出流outputstream">字节输出流：OutputStream</h5>

<p>OutputStream是整个IO包中字节输出流的最大父类，此类的定义如下：</p>

<p>public abstract class OutputStream extends Object implements Closeable,Flushable</p>

<p>从以上的定义可以发现，此类是一个抽象类，如果想要使用此类的话，则首先必须通过子类实例化对象，那么如果现在要操作的是一个文件，则可以使用：FileOutputStream类。通过向上转型之后，可以为OutputStream实例化</p>

<p>Closeable表示可以关闭的操作，因为程序运行到最后肯定要关闭</p>

<p>Flushable：表示刷新，清空内存中的数据</p>

<p>FileOutputStream类的构造方法如下：</p>

<p>public FileOutputStream(File file)throws FileNotFoundException</p>

<p>写数据：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">OutputStream</span> <span class="n">out</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">f</span><span class="o">);</span><span class="c1">//如果文件不存在会自动创建</span>
        <span class="nc">String</span> <span class="n">str</span><span class="o">=</span><span class="s">"Hello World"</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
        <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">);</span><span class="c1">//因为是字节流，所以要转化成字节数组进行输出</span>
        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>也可以一个字节一个字节进行输出，如下：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">OutputStream</span> <span class="n">out</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">f</span><span class="o">);</span><span class="c1">//如果文件不存在会自动创建</span>
        <span class="nc">String</span> <span class="n">str</span><span class="o">=</span><span class="s">"Hello World"</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">b</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>以上输出只会进行覆盖，如果要追加的话，请看FileOutputStream类的另一个构造方法：</p>

<p>public FileOutputStream(File file,boolean append)throws FileNotFoundException</p>

<p>在构造方法中，如果将append的值设置为true，则表示在文件的末尾追加内容。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">OutputStream</span> <span class="n">out</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span><span class="c1">//追加内容</span>
        <span class="nc">String</span> <span class="n">str</span><span class="o">=</span><span class="s">"\r\nHello World"</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">b</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>文件中换行为：\r\n</p>

<h5 id="字节输入流inputstream">字节输入流：InputStream</h5>

<p>既然程序可以向文件中写入内容，则就可以通过InputStream从文件中把内容读取进来，首先来看InputStream类的定义：</p>

<p>public abstract class InputStream extends Object implements Closeable</p>

<p>与OutputStream类一样，InputStream本身也是一个抽象类，必须依靠其子类，如果现在是从文件中读取，就用FileInputStream来实现。</p>

<p>观察FileInputStream类的构造方法：</p>

<p>public FileInputStream(File file)throws FileNotFoundException</p>

<p>读文件：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">InputStream</span> <span class="n">in</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">b</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>但以上方法是有问题的，用不用开辟这么大的一个字节数组，明显是浪费嘛，我们可以根据文件的大小来定义字节数组的大小，File类中的方法：public long length()</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">InputStream</span> <span class="n">in</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="n">f</span><span class="o">.</span><span class="na">length</span><span class="o">()];</span>
        <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">b</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>我们换种方式，一个字节一个字节读入~</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">InputStream</span> <span class="n">in</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="n">f</span><span class="o">.</span><span class="na">length</span><span class="o">()];</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">b</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">b</span><span class="o">[</span><span class="n">i</span><span class="o">]=(</span><span class="kt">byte</span><span class="o">)</span> <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">b</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>但以上情况只适合知道输入文件的大小，不知道的话用如下方法：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">InputStream</span> <span class="n">in</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">temp</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="k">while</span><span class="o">((</span><span class="n">temp</span><span class="o">=</span><span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">())!=-</span><span class="mi">1</span><span class="o">){</span><span class="c1">//-1为文件读完的标志</span>
            <span class="n">b</span><span class="o">[</span><span class="n">len</span><span class="o">]=(</span><span class="kt">byte</span><span class="o">)</span> <span class="n">temp</span><span class="o">;</span>
            <span class="n">len</span><span class="o">++;</span>
        <span class="o">}</span>
        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">b</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="字符流">字符流</h4>
<p>在程序中一个字符等于两个字节，那么java提供了Reader、Writer两个专门操作字符流的类。</p>

<h5 id="字符输出流writer">字符输出流：Writer</h5>

<p>Writer本身是一个字符流的输出类，此类的定义如下：</p>

<p>public abstract class Writer extends Object implements Appendable，Closeable，Flushable</p>

<p>此类本身也是一个抽象类，如果要使用此类，则肯定要使用其子类，此时如果是向文件中写入内容，所以应该使用FileWriter的子类。</p>

<p>FileWriter类的构造方法定义如下：</p>

<p>public FileWriter(File file)throws IOException</p>

<p>字符流的操作比字节流操作好在一点，就是可以直接输出字符串了，不用再像之前那样进行转换操作了。</p>

<p>写文件：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Writer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">Writer</span> <span class="n">out</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileWriter</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">str</span><span class="o">=</span><span class="s">"Hello World"</span><span class="o">;</span>
        <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>在默认情况下再次输出会覆盖，追加的方法也是在构造函数上加上追加标记</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Writer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">Writer</span> <span class="n">out</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileWriter</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span><span class="c1">//追加</span>
        <span class="nc">String</span> <span class="n">str</span><span class="o">=</span><span class="s">"\r\nHello World"</span><span class="o">;</span>
        <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h5 id="字符输入流reader">字符输入流：Reader</h5>

<p>Reader是使用字符的方式从文件中取出数据，Reader类的定义如下：</p>

<p>public abstract class Reader extends Objects implements Readable，Closeable</p>

<p>Reader本身也是抽象类，如果现在要从文件中读取内容，则可以直接使用FileReader子类。</p>

<p>FileReader的构造方法定义如下：</p>

<p>public FileReader(File file)throws FileNotFoundException</p>

<p>以字符数组的形式读取出数据：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Reader</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">Reader</span> <span class="n">input</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileReader</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
        <span class="kt">char</span><span class="o">[]</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">c</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>也可以用循环方式，判断是否读到底：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Reader</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s">"test.txt"</span><span class="o">);</span>
        <span class="nc">Reader</span> <span class="n">input</span><span class="o">=</span><span class="k">new</span> <span class="nc">FileReader</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
        <span class="kt">char</span><span class="o">[]</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">temp</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="k">while</span><span class="o">((</span><span class="n">temp</span><span class="o">=</span><span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">())!=-</span><span class="mi">1</span><span class="o">){</span>
            <span class="n">c</span><span class="o">[</span><span class="n">len</span><span class="o">]=(</span><span class="kt">char</span><span class="o">)</span> <span class="n">temp</span><span class="o">;</span>
            <span class="n">len</span><span class="o">++;</span>
        <span class="o">}</span>
        <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">c</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
</div><p><a href="/java/io">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=io%E6%B5%81">io流</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="java-io-2020-06-18-01">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-06-18T00:00:00+08:00">
    <meta itemprop="keywords" content="io流"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/jvm/mianshiti"><h2 itemprop="headline" class="item__header">jvm面试题</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><h3 id="new一个对象过程中发生了什么">new一个对象过程中发生了什么？</h3>

<ol>
  <li><strong>确认类元信息是否存在</strong>。当 JVM 接收到 new 指令时，首先在 metaspace 内检查需要创建的类元信息是否存在。 若不存在，那么在双亲委派模式下，使用当前类加载器以 ClassLoader + 包名＋类名为 Key 进行查找对应的 class 文件。 如果没有找到文件，则抛出 ClassNotFoundException 异常 ， 如果找到，则进行类加载（加载 - 验证 - 准备 - 解析 - 初始化），并生成对应的 Class 类对象。</li>
  <li><strong>分配对象内存</strong>。 首先计算对象占用空间大小，如果实例成员变量是引用变量，仅分配引用变量空间即可，即 4 个字节大小，接着在堆中划分—块内存给新对象。 在分配内存空间时，需要进行同步操作，比如采用 CAS (Compare And Swap) 失败重试、 区域加锁等方式保证分配操作的原子性。</li>
  <li><strong>设定默认值</strong>。 成员变量值都需要设定为默认值， 即各种不同形式的零值。</li>
  <li><strong>设置对象头</strong>。设置新对象的哈希码、 GC 信息、锁信息、对象所属的类元信息等。这个过程的具体设置方式取决于 JVM 实现。</li>
  <li><strong>执行 init 方法</strong>。 初始化成员变量，执行实例化代码块，调用类的构造方法，并把堆内对象的首地址赋值给引用变量。</li>
</ol>

<h4 id="类加载的时机">类加载的时机</h4>

<p>对于初始化阶段，虚拟机规范规定了有且只有 5 种情况必须立即对类进行“初始化”（而加载、验证、准备自然需要在此之前开始）：</p>

<ol>
  <li>遇到new、getstatic 和 putstatic 或 invokestatic 这4条字节码指令时，如果类没有进行过初始化，则需要先触发其初始化。对应场景是：使用 new 实例化对象、读取或设置一个类的静态字段（被 final 修饰、已在编译期把结果放入常量池的静态字段除外）、以及调用一个类的静态方法。</li>
  <li>对类进行反射调用的时候，如果类没有进行过初始化，则需要先触发其初始化。</li>
  <li>当初始化类的父类还没有进行过初始化，则需要先触发其父类的初始化。（而一个接口在初始化时，并不要求其父接口全部都完成了初始化）</li>
  <li>虚拟机启动时，用户需要指定一个要执行的主类（包含 main() 方法的那个类），
虚拟机会先初始化这个主类。</li>
  <li>当使用 JDK 1.7 的动态语言支持时，如果一个 java.lang.invoke.MethodHandle 实例最后的解析结果 REF_getStatic、REF_putStatic、REF_invokeStatic 的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需要先触发其初始化。</li>
</ol>

<p><strong>第5种情况，我暂时看不懂</strong>。</p>

<p>以上这 5 种场景中的行为称为对一个类进行主动引用。除此之外，所有引用类的方式都不会触发初始化，称为被动引用，例如：</p>

<ol>
  <li>通过子类引用父类的静态字段，不会导致子类初始化。</li>
  <li>通过数组定义来引用类，不会触发此类的初始化。MyClass[] cs = new MyClass[10];</li>
  <li>常量在编译阶段会存入调用类的常量池中，本质上并没有直接引用到定义常量的类，因此不会触发定义常量的类的初始化。</li>
</ol>
</div><p><a href="/jvm/mianshiti">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=jvm%E9%9D%A2%E8%AF%95%E9%A2%98">jvm面试题</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jun 15, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="jvm-2020-06-15-05">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-06-15T00:00:00+08:00">
    <meta itemprop="keywords" content="jvm面试题"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/jvm/classloader/myself"><h2 itemprop="headline" class="item__header">自定义类加载器</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><p>Java 默认 ClassLoader，只加载指定目录下的 class，如果需要动态加载类到内存，<strong>例如</strong> 要从远程网络下载的二进制文件类（*.class），然后调用这个类中的方法实现我的业务逻辑，如此，就需要自定义 ClassLoader。</p>

<p>自定义类加载器分为两步：</p>

<ol>
  <li>继承 java.lang.ClassLoader</li>
  <li>重写父类的 findClass() 方法</li>
</ol>

<p><strong>针对第 1 步</strong>，为什么要继承 ClassLoader 这个抽象类，而不继承 AppClassLoader 呢？
因为它和 ExtClassLoader 都是 Launcher 的静态内部类，其访问权限是缺省的包访问权限。
<code class="language-plaintext highlighter-rouge">static class AppClassLoader extends URLClassLoader{...}</code></p>

<p><strong>第 2 步</strong>，JDK 的 <code class="language-plaintext highlighter-rouge">loadCalss()</code> 方法在所有父类加载器无法加载的时候，会调用本身的 <code class="language-plaintext highlighter-rouge">findClass()</code> 方法来进行类加载，因此我们只需重写 <code class="language-plaintext highlighter-rouge">findClass()</code> 方法找到类的二进制数据即可。</p>

<p>下面我自定义了一个简单的类加载器，并加载一个简单的类。</p>

<p>首先是需要被加载的简单类：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 存放于D盘根目录</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Test类已成功加载运行！"</span><span class="o">);</span>
        <span class="nc">ClassLoader</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="nc">Test</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"加载我的classLoader："</span> <span class="o">+</span> <span class="n">classLoader</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"classLoader.parent："</span> <span class="o">+</span> <span class="n">classLoader</span><span class="o">.</span><span class="na">getParent</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>并使用 <code class="language-plaintext highlighter-rouge">javac -encoding utf8 Test.java</code> 编译成 Test.class 文件。</p>

<p>类加载器代码如下：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClassLoader</span> <span class="kd">extends</span> <span class="nc">ClassLoader</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">findClass</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
        <span class="c1">// 加载D盘根目录下指定类名的class</span>
        <span class="nc">String</span> <span class="n">clzDir</span> <span class="o">=</span> <span class="s">"D:\\"</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separatorChar</span>
                <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="sc">'.'</span><span class="o">,</span> <span class="nc">File</span><span class="o">.</span><span class="na">separatorChar</span><span class="o">)</span> <span class="o">+</span> <span class="s">".class"</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">classData</span> <span class="o">=</span> <span class="n">getClassData</span><span class="o">(</span><span class="n">clzDir</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">classData</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ClassNotFoundException</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">defineClass</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">classData</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">classData</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getClassData</span><span class="o">(</span><span class="nc">String</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">InputStream</span> <span class="n">ins</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
             <span class="nc">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">()</span>
        <span class="o">)</span> <span class="o">{</span>

            <span class="kt">int</span> <span class="n">bufferSize</span> <span class="o">=</span> <span class="mi">4096</span><span class="o">;</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">bufferSize</span><span class="o">];</span>
            <span class="kt">int</span> <span class="n">bytesNumRead</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">bytesNumRead</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">bytesNumRead</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>使用类加载器加载调用 Test 类：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClassLoaderTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// 指定类加载器加载调用</span>
        <span class="nc">MyClassLoader</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyClassLoader</span><span class="o">();</span>
        <span class="n">classLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="s">"Test"</span><span class="o">).</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"test"</span><span class="o">).</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>输出信息：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Test.test()已成功加载运行！
加载我的classLoader：class MyClassLoader
classLoader.parent：class sun.misc.Launcher$AppClassLoader
</code></pre></div></div>
</div><p><a href="/jvm/classloader/myself">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=jvm">jvm</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">类加载器</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jun 15, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="jvm-2020-06-15-03">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-06-15T00:00:00+08:00">
    <meta itemprop="keywords" content="jvm,类加载器"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/jvm/classloader/context"><h2 itemprop="headline" class="item__header">线程上下文类加载器</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><p>如上所说 <a href="/jvm/classloader/myself">自定义类加载器</a> ，为解决基础类无法调用类加载器加载用户提供代码的问题，Java 引入了线程上下文类加载器（Thread Context ClassLoader）。这个类加载器默认就是 Application 类加载器，并且可以通过 java.lang.Thread.setContextClassLoaser() 方法进行设置。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Now create the class loader to use to launch the application</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="nc">AppClassLoader</span><span class="o">.</span><span class="na">getAppClassLoader</span><span class="o">(</span><span class="n">extcl</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">InternalError</span><span class="o">(</span>
<span class="s">"Could not create application class loader"</span> <span class="o">);</span>
<span class="o">}</span>

<span class="c1">// Also set the context class loader for the primordial thread.</span>
<span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">setContextClassLoader</span><span class="o">(</span><span class="n">loader</span><span class="o">);</span>
</code></pre></div></div>
<p>那么问题来了，我们使用 <code class="language-plaintext highlighter-rouge">ClassLoader.getSystemClassLoader()</code> 方法也可以获取到 Application 类加载器，使用它就可以加载用户类了呀，为什么还需要线程上下文类加载器？
其实直接使用 <code class="language-plaintext highlighter-rouge">getSystemClassLoader()</code> 方法获取 AppClassLoader 加载类也可以满足一些情况，但有时候我们需要使用自定义类加载器去加载某个位置的类时，例如Tomcat 使用的线程上下文类加载器并非 AppClassLoader ，而是 Tomcat 自定义类加载器。</p>

<p>以 Tomcat 为例，其每个 Web 应用都有一个对应的类加载器实例，该类加载器使用代理模式，首先尝试去加载某个类，如果找不到再代理给父类加载器这与一般类加载器的顺序是相反的。
这是 Java Servlet 规范中的推荐做法，其目的是使得 Web 应用自己的类的优先级高于 Web 容器提供的类。</p>

<p>更多关于 Tomcat 类加载器的知识，这里暂时先不讲了。</p>
</div><p><a href="/jvm/classloader/context">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=jvm">jvm</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">类加载器</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jun 15, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="jvm-2020-06-15-04">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-06-15T00:00:00+08:00">
    <meta itemprop="keywords" content="jvm,类加载器"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/jvm/classloader"><h2 itemprop="headline" class="item__header">类加载器</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><h3 id="类加载器">类加载器</h3>

<p>把实现类加载阶段中的“通过一个类的全限定名来获取描述此类的二进制字节流”这个动作的代码模块称为“类加载器”。</p>

<p>将 class 文件二进制数据放入方法区内，然后在堆内（heap）创建一个 java.lang.Class 对象，Class 对象封装了类在方法区内的数据结构，并且向开发者提供了访问方法区内的数据结构的接口。</p>

<p>目前类加载器却在类层次划分、OSGi、热部署、代码加密等领域非常重要，我们运行任何一个 Java 程序都会涉及到类加载器。</p>

<h4 id="类的唯一性和类加载器">类的唯一性和类加载器</h4>

<p>对于任意一个类，都需要由加载它的类加载器和这个类本身一同确立其在Java虚拟机中的唯一性。</p>

<p>即使两个类来源于同一个 Class 文件，被同一个虚拟机加载，只要加载它们的类加载器不同，那这两个类也不相等。
这里所指的“相等”，包括代表类的 Class 对象的 equals() 方法、 isAssignableFrom() 方法、isInstance() 方法的返回结果，也包括使用 instanceof 关键字做对象所属关系判定等情况。</p>

<h4 id="双亲委派模型">双亲委派模型</h4>

<p>如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把这个请求委派给父类加载器去完成，每一个层次的类加载器都是如此，因此所有的加载请求最终都应该传送到顶层的启动类加载器中，只有当父加载器反馈自己无法完成这个加载请求（它的搜索范围中没有找到所需的类）时，子加载器才会尝试自己去加载。</p>

<p><img src="/assets/images/jvm/14923529-7ca333cbae4c1edd.png" alt="pic2" /></p>

<p>这里类加载器之间的父子关系一般不会以继承（Inheritance）的关系来实现，而是都使用组合（Composition）关系来复用父加载器的代码。</p>

<p>Bootstrap 类加载器是用 C++ 实现的，是虚拟机自身的一部分，如果获取它的对象，将会返回 null；扩展类加载器和应用类加载器是独立于虚拟机外部，为 Java 语言实现的，均继承自抽象类 java.lang.ClassLoader ，开发者可直接使用这两个类加载器。</p>

<p>Application 类加载器对象可以由 <code class="language-plaintext highlighter-rouge">ClassLoader.getSystemClassLoader()</code> 方法的返回，所以一般也称它为系统类加载器。它负责加载用户类路径（ClassPath）上所指定的类库，如果应用程序中没有自定义过自己的类加载器，一般情况下这个就是程序中默认的类加载器。</p>

<p>双亲委派模型对于保证 Java 程序的稳定运作很重要，例如类 <code class="language-plaintext highlighter-rouge">java.lang.Object</code>，它存放在 rt.jar 之中，无论哪一个类加载器要加载这个类，最终都是委派给处于模型最顶端的启动类加载器进行加载，因此 Object 类在程序的各种类加载器环境中都是同一个类。</p>

<p>双亲委派模型的加载类逻辑可参考如下代码：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 代码摘自《深入理解Java虚拟机》</span>
<span class="kd">protected</span> <span class="kd">synchronized</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">loadClass</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">resolve</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
    <span class="c1">// 首先，检查请求的类是否已经被加载过了</span>
    <span class="nc">Class</span> <span class="n">c</span> <span class="o">=</span> <span class="n">findLoadedClass</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">parent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">findBootstrapClassOrNull</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 如果父类加载器抛出ClassNotFoundException</span>
        <span class="c1">// 说明父类加载器无法完成加载请求</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 在父类加载器无法加载的时候</span>
            <span class="c1">// 再调用本身的findClass方法来进行类加载</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">findClass</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">resolve</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">resolveClass</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">c</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<h4 id="破坏双亲委派模型">破坏双亲委派模型</h4>

<p>双亲委派模型主要出现过 3 较大规模的“被破坏”情况。</p>

<ol>
  <li>双亲委派模型在引入之前已经存在破坏它的代码存在了。
双亲委派模型在 JDK 1.2 之后才被引入，而类加载器和抽象类 java.lang.ClassLoader 则在 JDK 1.0 时代就已经存在，JDK 1.2之后，其添加了一个新的 protected 方法 findClass()，在此之前，用户去继承 ClassLoader 类的唯一目的就是为了重写 loadClass() 方法，而双亲委派的具体逻辑就实现在这个方法之中，JDK 1.2 之后已不提倡用户再去覆盖 loadClass() 方法，而应当把自己的类加载逻辑写到 findClass() 方法中，这样就可以保证新写出来的类加载器是符合双亲委派规则的。</li>
  <li>基础类无法调用类加载器加载用户提供的代码。
双亲委派很好地解决了各个类加载器的基础类的统一问题（越基础的类由越上层的加载器进行加载），但如果基础类又要调用用户的代码，例如 JNDI 服务，JNDI 现在已经是 Java 的标准服务，它的代码由启动类加载器去加载（在 JDK 1.3 时放进去的 rt.jar ），但 JNDI 的目的就是对资源进行集中管理和查找，它需要调用由独立厂商实现并部署在应用程序的 ClassPath 下的 JNDI 接口提供者（SPI,Service Provider Interface，例如 JDBC 驱动就是由 MySQL 等接口提供者提供的）的代码，但启动类加载器只能加载基础类，无法加载用户类。
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>为此 Java 引入了线程上下文类加载器（Thread Context ClassLoader）。这个类加载器可以通过 java.lang.Thread.setContextClassLoaser() 方法进行设置，如果创建线程时还未设置，它将会从父线程中继承一个，如果在应用程序的全局范围内都没有设置过的话，那这个类加载器默认就是应用程序类加载器。
如此，JNDI 服务使用这个线程上下文类加载器去加载所需要的 SPI 代码，也就是父类加载器请求子类加载器去完成类加载的动作，这种行为实际上就是打通了双亲委派模型的层次结构来逆向使用类加载器，实际上已经违背了双亲委派模型的一般性原则，但这也是无可奈何的事情。Java 中所有涉及 SPI 的加载动作基本上都采用这种方式，例如 JNDI、JDBC、JCE、JAXB 和 JBI 等。
</code></pre></div>    </div>
  </li>
  <li>用户对程序动态性的追求。
代码热替换（HotSwap）、模块热部署（Hot Deployment）等，OSGi 实现模块化热部署的关键则是它自定义的类加载器机制的实现。每一个程序模块（Bundle）都有一个自己的类加载器，当需要更换一个 Bundle 时，就把 Bundle 连同类加载器一起换掉以实现代码的热替换。
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>在 OSGi 环境下，类加载器不再是双亲委派模型中的树状结构，而是进一步发展为更加复杂的网状结构，当收到类加载请求时，OSGi 将按照下面的顺序进行类搜索：
1）将以 java.* 开头的类委派给父类加载器加载。
2）否则，将委派列表名单内的类委派给父类加载器加载。
3）否则，将 Import 列表中的类委派给 Export 这个类的 Bundle 的类加载器加载。
4）否则，查找当前 Bundle 的 ClassPath，使用自己的类加载器加载。
5）否则，查找类是否在自己的 Fragment Bundle 中，如果在，则委派给 Fragment Bundle 的类加载器加载。
6）否则，查找 Dynamic Import 列表的 Bundle，委派给对应 Bundle 的类加载器加载。
7）否则，类查找失败。
上面的查找顺序中只有开头两点仍然符合双亲委派规则，其余的类查找都是在平级的类加载器中进行的。OSGi 的 Bundle 类加载器之间只有规则，没有固定的委派关系。
</code></pre></div>    </div>
  </li>
</ol>
</div><p><a href="/jvm/classloader">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=jvm">jvm</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">类加载器</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jun 15, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="jvm-2020-06-15-07">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-06-15T00:00:00+08:00">
    <meta itemprop="keywords" content="jvm,类加载器"></div>
      </article><article class="item" itemscope itemtype="http://schema.org/BlogPosting"><div class="item__content">
          <header><a href="/jvm/classloader/deep"><h2 itemprop="headline" class="item__header">深入理解Java类加载</h2></a></header>
          <div class="item__description"><div class="article__content" itemprop="description articleBody"><h3 id="java虚拟机类加载机制">Java虚拟机类加载机制</h3>

<p>虚拟机把描述类的数据从 Class 文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的 Java 类型，这就是虚拟机的类加载机制。</p>

<p>在Java语言里面，类型的加载、连接和初始化过程都是在程序运行期间完成的</p>

<h4 id="类加载的过程">类加载的过程</h4>

<p>类的个生命周期如下图：</p>

<p><img src="/assets/images/jvm/14923529-ac753500687cf9d2.png" alt="pic1" /></p>

<p>为支持运行时绑定，解析过程在某些情况下可在初始化之后再开始，除解析过程外的其他加载过程必须按照如图顺序开始。</p>

<h4 id="加载">加载</h4>

<ol>
  <li>通过全限定类名来获取定义此类的二进制字节流。</li>
  <li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。</li>
  <li>在内存中生成一个代表这个类的 java.lang.Class 对象，作为方法区这个类的各种数据的访问入口。</li>
</ol>

<h4 id="验证">验证</h4>

<p>验证是连接阶段的第一步，这一阶段的目的是为了确保 Class 文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。</p>

<ol>
  <li>文件格式验证：如是否以魔数 0xCAFEBABE 开头、主、次版本号是否在当前虚拟机处理范围之内、常量合理性验证等。
此阶段保证输入的字节流能正确地解析并存储于方法区之内，格式上符合描述一个 Java类型信息的要求。</li>
  <li>元数据验证：是否存在父类，父类的继承链是否正确，抽象类是否实现了其父类或接口之中要求实现的所有方法，字段、方法是否与父类产生矛盾等。
第二阶段，保证不存在不符合 Java 语言规范的元数据信息。</li>
  <li>字节码验证：通过数据流和控制流分析，确定程序语义是合法的、符合逻辑的。例如保证跳转指令不会跳转到方法体以外的字节码指令上。
符号引用验证：在解析阶段中发生，保证可以将符号引用转化为直接引用。</li>
  <li>可以考虑使用 -Xverify:none 参数来关闭大部分的类验证措施，以缩短虚拟机类加载的时间。</li>
</ol>

<h3 id="准备">准备</h3>

<p>为 <strong>类变量</strong> 分配内存并设置类变量初始值，这些变量所使用的内存都将在方法区中进行分配。</p>

<h4 id="解析">解析</h4>

<p>虚拟机将常量池内的符号引用替换为直接引用的过程。
解析动作主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用点限定符 7 类符号引用进行。</p>

<h4 id="初始化">初始化</h4>

<p>到初始化阶段，才真正开始执行类中定义的 Java 程序代码，此阶段是执行 &lt;clinit&gt;() 方法的过程。</p>

<p>&lt;clinit&gt;() 方法是由编译器按语句在源文件中出现的顺序，依次自动收集类中的所有 <strong>类变量</strong> 的赋值动作和静态代码块中的语句合并产生的。（不包括构造器中的语句。构造器是初始化对象的，类加载完成后，创建对象时候将调用的 &lt;init&gt;() 方法来初始化对象）</p>

<p>静态语句块中只能访问到定义在静态语句块之前的变量，定义在它之后的变量，在前面的静态语句块可以赋值，但是不能访问，如下程序：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="c1">// 给变量赋值可以正常编译通过</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="c1">// 这句编译器会提示"非法向前引用"</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>&lt;clinit&gt;() 不需要显式调用父类（接口除外，接口不需要调用父接口的初始化方法，只有使用到父接口中的静态变量时才需要调用）的初始化方法 &lt;clinit&gt;()，虚拟机会保证在子类的 &lt;clinit&gt;() 方法执行之前，父类的 &lt;clinit&gt;() 方法已经执行完毕，也就意味着父类中定义的静态语句块要优先于子类的变量赋值操作。</p>

<p>&lt;clinit&gt;() 方法对于类或接口来说并不是必需的，如果一个类中没有静态语句块，也没有对变量的赋值操作，那么编译器可以不为这个类生成 &lt;clinit&gt;() 方法。</p>

<p>虚拟机会保证一个类的 &lt;clinit&gt;() 方法在多线程环境中被正确地加锁、同步，如果多个线程同时去初始化一个类，那么只会有一个线程去执行这个类的 &lt;clinit&gt;() 方法，其他线程都需要阻塞等待，直到活动线程执行 &lt;clinit&gt;() 方法完毕。</p>
</div><p><a href="/jvm/classloader/deep">Read more</a></p></div><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=jvm">jvm</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=%E7%B1%BB%E5%8A%A0%E8%BD%BD">类加载</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jun 15, 2020</span>
            </li><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="jvm-2020-06-15-02">0</span> views</li></ul></div><meta itemprop="author" content="java牛牛"/><meta itemprop="datePublished" content="2020-06-15T00:00:00+08:00">
    <meta itemprop="keywords" content="jvm,类加载"></div>
      </article></div>
</div><div class="layout--home"><div class="pagination"><p>251 post articles, 32 pages.</p>
    <div class="pagination__menu">
      <ul class="menu menu--nowrap"><li><div class="button button--secondary button--circle disabled">
            <i class="fas fa-angle-left"></i>
          </div></li><li>
              <div class="button button--primary button--circle focus"><span>1</span></div>
            </li><li>
                  <a class="button button--secondary button--circle" href="/home/page2"><span>2</span></a>
                </li><li>
                  <a class="button button--secondary button--circle" href="/home/page3"><span>3</span></a>
                </li><li>
                  <a class="button button--secondary button--circle" href="/home/page4"><span>4</span></a>
                </li><li><span class="pagination__omit"><i class="fas fa-ellipsis-h"></i></span></li><li>
                  <a class="button button--secondary button--circle" href="/home/page32"><span>32</span></a>
                </li><li><a class="button button--secondary button--circle" href="/home/page2">
            <i class="fas fa-angle-right"></i>
          </a></li></ul>
    </div>
  </div></div>
<script>/*(function () {

})();*/
</script>



</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="java牛牛"><meta itemprop="url" content="/javaniuniu.com"><meta itemprop="description" content="I am an amazing person.
"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><link itemprop="url" href="javaniuniu.com"><li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:king101125s@gmail.com" target="_blank">
        <i class="fas fa-envelope"></i>
      </a><li title="Follow me on Facebook.">
        <a class="button button--circle facebook-button" itemprop="sameAs" href="https://www.facebook.com/minplemon" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M767.428571 6.857143l0 150.857143-89.714286 0q-49.142857 0-66.285714 20.571429t-17.142857 61.714286l0 108 167.428571 0-22.285714 169.142857-145.142857 0 0 433.714286-174.857143 0 0-433.714286-145.714286 0 0-169.142857 145.714286 0 0-124.571429q0-106.285714 59.428571-164.857143t158.285714-58.571429q84 0 130.285714 6.857143z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://twitter.com/minplemon" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M1024.032 194.432c-37.664 16.704-78.176 28-120.672 33.088 43.36-26.016 76.672-67.168 92.384-116.224-40.608 24.064-85.568 41.568-133.408 50.976-38.336-40.832-92.928-66.336-153.344-66.336-116.032 0-210.08 94.048-210.08 210.08 0 16.48 1.856 32.512 5.44 47.872-174.592-8.768-329.408-92.416-433.024-219.52-18.08 31.04-28.448 67.104-28.448 105.632 0 72.896 37.088 137.184 93.472 174.88-34.432-1.088-66.816-10.528-95.168-26.272-0.032 0.864-0.032 1.76-0.032 2.656 0 101.792 72.416 186.688 168.512 205.984-17.632 4.8-36.192 7.36-55.36 7.36-13.536 0-26.688-1.312-39.52-3.776 26.72 83.456 104.32 144.192 196.256 145.888-71.904 56.352-162.496 89.92-260.928 89.92-16.96 0-33.664-0.992-50.112-2.944 92.96 59.616 203.392 94.4 322.048 94.4 386.432 0 597.728-320.128 597.728-597.76 0-9.12-0.192-18.176-0.608-27.168 41.056-29.632 76.672-66.624 104.832-108.736z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/javaniuniu" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© JAVA 牛牛 2020, <a href="http://www.beian.miit.gov.cn/">浙ICP备20011288号</a>
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  window.Lazyload.js(['https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js', 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js'], function() {
    var $canvas = null, $this = null, _ctx = null, _text = '';
    $('.language-chart').each(function(){
      $this = $(this);
      $canvas = $('<canvas></canvas>');
      _text = $this.text();
      $this.text('').append($canvas);
      _ctx = $canvas.get(0).getContext('2d');
      (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
    });
  });
</script>
<script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};_config.TeX = { equationNumbers: { autoNumber: "all" } };MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  window.Lazyload.js('https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js', function() {
    mermaid.initialize({
      startOnLoad: true
    });
    mermaid.init(undefined, '.language-mermaid');
  });
</script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

